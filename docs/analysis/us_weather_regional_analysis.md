# アメリカweatherデータの地域差分析レポート

## 概要

アメリカのweatherデータのマイグレーションを確認し、地域差を統計的に分析しました。

**分析日**: 2025-01-XX  
**データソース**: `db/fixtures/us_reference_weather.json`  
**分析対象**: 50ファーム（10州）

## 主な発見

### 1. 気温データには明確な地域差がある

**平均気温の統計（全50ファーム）**:
- 平均: 11.18°C
- 中央値: 10.76°C
- 標準偏差: 4.50°C
- 範囲: **5.07°C ～ 21.79°C** (差: 16.72°C)
- 変動係数: 40.27%

**地域差の評価**:
- ✅ **地域差は適度にあります**
- 最高気温（Harris County, TX: 21.79°C）と最低気温（Grand Forks County, ND: 5.07°C）の差は16.72°C
- 平均に対する差の割合は149.61%

### 2. 州別の統計

| 州 | ファーム数 | 平均気温（平均） | 範囲 | 標準偏差 |
|----|-----------|----------------|------|---------|
| **TX** (テキサス) | 5 | **20.48°C** | 19.57°C ～ 21.79°C | 0.82°C |
| **CA** (カリフォルニア) | 5 | **16.78°C** | 14.79°C ～ 19.23°C | 2.28°C |
| **KS** (カンザス) | 5 | **13.52°C** | 13.26°C ～ 14.52°C | 0.56°C |
| **IL** (イリノイ) | 5 | **11.26°C** | 10.74°C ～ 11.73°C | 0.37°C |
| **NE** (ネブラスカ) | 5 | **11.07°C** | 10.78°C ～ 11.25°C | 0.26°C |
| **IA** (アイオワ) | 5 | **9.63°C** | 8.89°C ～ 11.02°C | 0.81°C |
| **SD** (サウスダコタ) | 5 | **7.84°C** | 6.57°C ～ 8.63°C | 1.06°C |
| **MN** (ミネソタ) | 5 | **7.30°C** | 6.77°C ～ 7.83°C | 0.50°C |
| **WI** (ウィスコンシン) | 5 | **8.27°C** | 8.03°C ～ 8.93°C | 0.37°C |
| **ND** (ノースダコタ) | 5 | **5.63°C** | 5.07°C ～ 6.56°C | 0.74°C |

**州間の気温差**:
- テキサス（20.48°C）とノースダコタ（5.63°C）の差: **14.85°C**

### 3. ⚠️ 重要な問題: 降水量と日照時間データが全欠損

**データ欠損状況**:
- **降水量データ**: 50/50ファームで欠損（100%欠損）
- **日照時間データ**: 50/50ファームで欠損（100%欠損）

**影響**:
- 降水量と日照時間による地域差の評価が不可能
- NOAA-FTPデータソースではこれらのデータが提供されていない可能性

### 4. 州内のばらつき

**州内標準偏差が大きい州**:
1. **CA** (カリフォルニア): 2.28°C - 州内で気温差が大きい
2. **TX** (テキサス): 0.82°C
3. **SD** (サウスダコタ): 1.06°C

**州内標準偏差が小さい州**:
1. **NE** (ネブラスカ): 0.26°C - 州内で非常に均一
2. **IL** (イリノイ): 0.37°C
3. **WI** (ウィスコンシン): 0.37°C

## マイグレーションの確認

### マイグレーションファイル
- `db/migrate/20251018075149_seed_united_states_reference_data.rb`
- `db/fixtures/us_reference_weather.json`からデータを読み込んで投入

### データ取得スクリプト
- `bin/fetch_us_reference_weather_data`
- NOAA-FTPからデータを取得
- `precipitation_sum`と`sunshine_hours`を取得しようとしているが、実際にはnullが返されている

### データ構造
```json
{
  "temperature_max": 13.3,
  "temperature_min": 5.0,
  "temperature_mean": 9.125,
  "precipitation": null,      // ⚠️ 全レコードでnull
  "sunshine_hours": null,     // ⚠️ 全レコードでnull
  "wind_speed": 14.76,
  "weather_code": null
}
```

## 結論

1. **気温データには明確な地域差がある**
   - テキサス（20.48°C）とノースダコタ（5.63°C）で14.85°Cの差
   - 変動係数40.27%は適度な地域差を示している

2. **降水量と日照時間データが全欠損している**
   - NOAA-FTPデータソースがこれらのデータを提供していない可能性
   - これらの指標で地域差を評価できない

3. **推奨事項**
   - NOAA-FTPの代替データソース（例: NASA POWER）の検討
   - 降水量と日照時間データの取得方法の見直し
   - 既存データの再取得が必要な場合、データソースの変更を検討

## 付録: 分析スクリプト

分析に使用したスクリプト:
- `scripts/analyze_us_weather_regional_differences.py`

実行方法:
```bash
python3 scripts/analyze_us_weather_regional_differences.py
```

