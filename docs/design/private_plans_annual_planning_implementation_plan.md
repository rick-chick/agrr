# Private Plans é€šå¹´è¨ˆç”» å®Ÿè£…è¨ˆç”»æ›¸ï¼ˆå„ªå…ˆåº¦ä»˜ãï¼‰

## ğŸ“‹ æ¦‚è¦

æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€`private_plans_annual_planning_design.md`ã€`private_plans_annual_planning_design_verification.md`ã€`private_plans_annual_planning_design_additional_considerations.md`ã‚’åŸºã«ã€å„ªå…ˆåº¦ã‚’æ˜ç¢ºã«ã—ãŸå®Ÿè£…è¨ˆç”»ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚

## ğŸ¯ å®Ÿè£…ã®å…¨ä½“åƒ

å¹´åº¦ãƒ™ãƒ¼ã‚¹ã®è¨ˆç”»ç®¡ç†ã‹ã‚‰ã€è¾²å ´ãƒ™ãƒ¼ã‚¹ã®é€šå¹´è¨ˆç”»ç®¡ç†ã¸ã®ç§»è¡Œã€‚æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¨ã®å¾Œæ–¹äº’æ›æ€§ã‚’ä¿ã¡ãªãŒã‚‰ã€æ®µéšçš„ã«å®Ÿè£…ã‚’é€²ã‚ã¾ã™ã€‚

## ğŸ“Š å„ªå…ˆåº¦å®šç¾©

- **ğŸ”´ æœ€å„ªå…ˆï¼ˆCriticalï¼‰**: ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ãƒ»åŸºç›¤æ©Ÿèƒ½ã«ç›´çµã€‚ä»–ã«ä¾å­˜ã•ã‚Œã‚‹ãŸã‚æœ€åˆã«å®Ÿè£…
- **ğŸŸ  é«˜ï¼ˆHighï¼‰**: ä¸»è¦æ©Ÿèƒ½ã®å®Ÿè£…ã«å¿…è¦ã€‚Phase 1å®Œäº†å¾Œã«å®Ÿè£…
- **ğŸŸ¡ ä¸­ï¼ˆMediumï¼‰**: æ©Ÿèƒ½å®Œæˆã«å¿…è¦ã ãŒã€æ®µéšçš„ã«å®Ÿè£…å¯èƒ½
- **ğŸŸ¢ ä½ï¼ˆLowï¼‰**: UIæ”¹å–„ãƒ»æœ€é©åŒ–ã€‚ä¸»è¦æ©Ÿèƒ½å®Œæˆå¾Œã«å®Ÿè£…

---

## ğŸ”´ æœ€å„ªå…ˆï¼ˆPhase 1: ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«åŸºç›¤ï¼‰

### 1.1 ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£… ğŸ”´

**å„ªå…ˆåº¦**: æœ€å„ªå…ˆ  
**ä¾å­˜é–¢ä¿‚**: ãªã—  
**æ‰€è¦æ™‚é–“**: 2-3æ™‚é–“

#### ã‚¿ã‚¹ã‚¯
- [ ] æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®é‡è¤‡ãƒã‚§ãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆãƒ»å®Ÿè¡Œ
  - åŒã˜`farm_id Ã— user_id`ã§è¤‡æ•°ã®`plan_year`ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
  - é‡è¤‡ãŒã‚ã‚‹å ´åˆã¯ã‚¨ãƒ©ãƒ¼ã‚’å‡ºã—ã¦ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¸­æ­¢
- [ ] `plan_year`ã‚’nullableã«å¤‰æ›´
- [ ] æ—¢å­˜ã®ä¸€æ„åˆ¶ç´„ã‚’å‰Šé™¤ï¼ˆ`index_cultivation_plans_on_farm_user_year_unique`ï¼‰
- [ ] æ–°ã—ã„ä¸€æ„åˆ¶ç´„ã‚’è¿½åŠ ï¼ˆ`farm_id Ã— user_id`ã€`plan_type = 'private'`ã®æ¡ä»¶ä»˜ãï¼‰
- [ ] ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã®å®Ÿè£…

#### æ³¨æ„äº‹é …
- **é‡è¦**: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å‰ã«å¿…ãšé‡è¤‡ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿæ–½
- æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®`plan_year`ã¯ä¿æŒï¼ˆå¾Œæ–¹äº’æ›æ€§ï¼‰
- æœ¬ç•ªç’°å¢ƒã§ã¯äº‹å‰ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–å¾—

#### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `db/migrate/YYYYMMDDHHMMSS_change_private_plans_to_annual_planning.rb`

---

### 1.2 CultivationPlanãƒ¢ãƒ‡ãƒ«ã®å¤‰æ›´ ğŸ”´

**å„ªå…ˆåº¦**: æœ€å„ªå…ˆ  
**ä¾å­˜é–¢ä¿‚**: 1.1å®Œäº†å¾Œ  
**æ‰€è¦æ™‚é–“**: 1-2æ™‚é–“

#### ã‚¿ã‚¹ã‚¯
- [ ] `plan_year`ã®å¿…é ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤ï¼ˆprivateè¨ˆç”»ã§ã‚‚ï¼‰
- [ ] ä¸€æ„åˆ¶ç´„ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’å¤‰æ›´ï¼ˆ`farm_id Ã— user_id`ã®ã¿ï¼‰
- [ ] `display_name`ãƒ¡ã‚½ãƒƒãƒ‰ã®ä¿®æ­£
  - `plan_year`ãŒ`null`ã®å ´åˆã¯è¨ˆç”»æœŸé–“ã‚’è¡¨ç¤º
  - æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ï¼ˆ`plan_year`ã‚ã‚Šï¼‰ã¯å¾“æ¥é€šã‚Šè¡¨ç¤º
- [ ] `planning_start_date`ã¨`planning_end_date`ã®å¿…é ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¶­æŒ
- [ ] `calculate_planning_dates`ãƒ¡ã‚½ãƒƒãƒ‰ã¯å¾Œæ–¹äº’æ›æ€§ã®ãŸã‚æ®‹ã™

#### ã‚³ãƒ¼ãƒ‰ä¾‹
```ruby
# display_nameãƒ¡ã‚½ãƒƒãƒ‰ã®ä¿®æ­£
def display_name
  if plan_type_private?
    name = plan_name.presence || I18n.t('models.cultivation_plan.default_plan_name')
    if plan_year.present?
      "#{name} (#{plan_year})"
    elsif planning_start_date && planning_end_date
      "#{name} (#{planning_start_date.year}ã€œ#{planning_end_date.year})"
    else
      name
    end
  else
    I18n.t('models.cultivation_plan.public_plan_name')
  end
end
```

#### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `app/models/cultivation_plan.rb`

---

### 1.3 ãƒ¢ãƒ‡ãƒ«ãƒ†ã‚¹ãƒˆ ğŸ”´

**å„ªå…ˆåº¦**: æœ€å„ªå…ˆ  
**ä¾å­˜é–¢ä¿‚**: 1.2å®Œäº†å¾Œ  
**æ‰€è¦æ™‚é–“**: 2-3æ™‚é–“

#### ã‚¿ã‚¹ã‚¯
- [ ] `plan_year`ãŒ`null`ã§ã‚‚ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒé€šã‚‹ã“ã¨ã‚’ç¢ºèª
- [ ] ä¸€æ„åˆ¶ç´„ã®ãƒ†ã‚¹ãƒˆæ›´æ–°
  - åŒã˜`farm_id Ã— user_id`ã§è¤‡æ•°ã®è¨ˆç”»ã‚’ä½œæˆã§ããªã„ã“ã¨ã‚’ç¢ºèª
  - ç•°ãªã‚‹`farm_id`ã¾ãŸã¯`user_id`ã§ã¯ä½œæˆå¯èƒ½ãªã“ã¨ã‚’ç¢ºèª
- [ ] é€šå¹´è¨ˆç”»ï¼ˆ`plan_year`ãŒ`null`ï¼‰ã®ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ 
- [ ] æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®äº’æ›æ€§ãƒ†ã‚¹ãƒˆï¼ˆ`plan_year`ã‚ã‚Šã®è¨ˆç”»ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªï¼‰
- [ ] `display_name`ãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒ†ã‚¹ãƒˆè¿½åŠ 

#### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `test/models/cultivation_plan_test.rb`
- `spec/models/cultivation_plan_spec.rb`ï¼ˆRSpecã®å ´åˆï¼‰

---

### 1.4 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®æ•´ç† ğŸ”´

**å„ªå…ˆåº¦**: æœ€å„ªå…ˆ  
**ä¾å­˜é–¢ä¿‚**: 1.1å®Œäº†å¾Œ  
**æ‰€è¦æ™‚é–“**: 1æ™‚é–“

#### ã‚¿ã‚¹ã‚¯
- [ ] `plan_year`ã‚’å«ã‚€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ç¢ºèª
  - `index_cultivation_plans_on_user_plan_name_year`
  - `index_cultivation_plans_on_user_id_and_plan_year`
- [ ] ä¸è¦ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®å‰Šé™¤ã¾ãŸã¯æ¡ä»¶æ›´æ–°
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å‰Šé™¤å¾Œã®ã‚¯ã‚¨ãƒªé€Ÿåº¦ç¢ºèªï¼‰

#### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `db/schema.rb`
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«

---

## ğŸŸ  é«˜å„ªå…ˆåº¦ï¼ˆPhase 2: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤ï¼‰

### 2.0 PlanSaveServiceã®å¤‰æ›´ ğŸŸ 

**å„ªå…ˆåº¦**: é«˜  
**ä¾å­˜é–¢ä¿‚**: Phase 1å®Œäº†å¾Œ  
**æ‰€è¦æ™‚é–“**: 1-2æ™‚é–“

#### ã‚¿ã‚¹ã‚¯
- [ ] `find_existing_private_plan`ãƒ¡ã‚½ãƒƒãƒ‰ã®å¤‰æ›´
  - `plan_year`ã‚’é™¤å¤–ã—ã¦æ¤œç´¢
  - `farm_id`ã¨`user_id`ã®ã¿ã§æ¤œç´¢
- [ ] `calculate_plan_year_from_cultivations`ãƒ¡ã‚½ãƒƒãƒ‰ã®æ‰±ã„
  - é€šå¹´è¨ˆç”»ã®å ´åˆã€`plan_year`ã‚’`null`ã«ã™ã‚‹
  - å‚ç…§è¨ˆç”»ãŒé€šå¹´è¨ˆç”»ã®å ´åˆã¯ã€`plan_year`ã‚’è¨­å®šã—ãªã„
  - `planning_start_date`ã¨`planning_end_date`ã¯ä½œä»˜ã‘æœŸé–“ã‹ã‚‰è¨ˆç®—

#### ã‚³ãƒ¼ãƒ‰ä¾‹
```ruby
def find_existing_private_plan(farm)
  @user.cultivation_plans.where(plan_type: 'private', farm: farm).first
end
```

#### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `app/services/plan_save_service.rb`

---

### 2.1 PlansControllerã®å¤‰æ›´ ğŸŸ 

**å„ªå…ˆåº¦**: é«˜  
**ä¾å­˜é–¢ä¿‚**: Phase 1å®Œäº†å¾Œ  
**æ‰€è¦æ™‚é–“**: 3-4æ™‚é–“

#### ã‚¿ã‚¹ã‚¯
- [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®å¤‰æ›´
  - ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰`plan_year`ã‚’å‰Šé™¤
  - `validate_session_data`ã§`plan_year`ã®ãƒã‚§ãƒƒã‚¯ã‚’å‰Šé™¤
  - `find_existing_plan`ã§`plan_year`ã‚’é™¤å¤–ã—ã¦æ¤œç´¢
- [ ] `index`: å¹´åº¦åˆ¥ã‹ã‚‰è¾²å ´åˆ¥ã«å¤‰æ›´
- [ ] `new`: å¹´åº¦é¸æŠã‚’å‰Šé™¤ã€è¾²å ´é¸æŠã®ã¿
- [ ] `select_crop`: `plan_year`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰Šé™¤
- [ ] `create`: `plan_year`ã‚’ä½¿ã‚ãšã«è¨ˆç”»ä½œæˆ
- [ ] `build_creator_params`: `plan_year`ã‚’ä½¿ã‚ãšã«`planning_start_date`ã¨`planning_end_date`ã‚’è¨­å®š
- [ ] `copy`: é€šå¹´è¨ˆç”»ã®å ´åˆã®ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ã®æ‰±ã„ã‚’æ±ºå®š
  - ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ–
  - ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: è¨ˆç”»æœŸé–“ã‚’å»¶é•·ã™ã‚‹æ©Ÿèƒ½ã«å¤‰æ›´
  - ã‚ªãƒ—ã‚·ãƒ§ãƒ³3: è¨ˆç”»ã‚’è¤‡è£½ã™ã‚‹æ©Ÿèƒ½ã«å¤‰æ›´

#### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `app/controllers/plans_controller.rb`

---

### 2.2 Presenterå¤‰æ›´ ğŸŸ 

**å„ªå…ˆåº¦**: é«˜  
**ä¾å­˜é–¢ä¿‚**: 2.1å®Œäº†å¾Œ  
**æ‰€è¦æ™‚é–“**: 2-3æ™‚é–“

#### ã‚¿ã‚¹ã‚¯
- [ ] `Plans::IndexPresenter`
  - `plans_by_year`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’`plans_by_farm`ã«å¤‰æ›´
  - è¾²å ´åˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
  - `plan_year`ãŒ`null`ã®è¨ˆç”»ã‚‚æ­£ã—ãè¡¨ç¤º
- [ ] `Plans::NewPresenter`
  - å¹´åº¦é–¢é€£ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‰Šé™¤ï¼ˆ`available_years`ãªã©ï¼‰
- [ ] `Plans::SelectCropPresenter`
  - `plan_year`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã¾ãŸã¯ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«åŒ–
- [ ] `Plans::ShowPresenter`
  - è¡¨ç¤ºç¯„å›²é¸æŠæ©Ÿèƒ½ã‚’è¿½åŠ ï¼ˆå°†æ¥çš„ã«ä½¿ç”¨ï¼‰

#### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `app/presenters/plans/index_presenter.rb`
- `app/presenters/plans/new_presenter.rb`
- `app/presenters/plans/select_crop_presenter.rb`
- `app/presenters/plans/show_presenter.rb`

---

### 2.3 PlanningSchedulesControllerã®å¤‰æ›´ ğŸŸ 

**å„ªå…ˆåº¦**: é«˜  
**ä¾å­˜é–¢ä¿‚**: Phase 1å®Œäº†å¾Œ  
**æ‰€è¦æ™‚é–“**: 2-3æ™‚é–“

#### ã‚¿ã‚¹ã‚¯
- [ ] `plan_year`ã«ã‚ˆã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚’`planning_start_date`/`planning_end_date`ãƒ™ãƒ¼ã‚¹ã«å¤‰æ›´
- [ ] `field_cultivation.start_date.year == plan.plan_year`ã®é‡è¤‡é˜²æ­¢ãƒ­ã‚¸ãƒƒã‚¯ã‚’å¤‰æ›´
- [ ] é€šå¹´è¨ˆç”»ï¼ˆ`plan_year`ãŒ`null`ï¼‰ã®å¯¾å¿œ
  - `plan_year`ãŒ`null`ã®å ´åˆã¯æœŸé–“ãƒ™ãƒ¼ã‚¹ã§åˆ¤å®š
- [ ] æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ï¼ˆ`plan_year`ã‚ã‚Šï¼‰ã¨ã®äº’æ›æ€§ã‚’ä¿ã¤

#### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `app/controllers/planning_schedules_controller.rb`

---

### 2.4 PlanCopierã®å¤‰æ›´ ğŸŸ 

**å„ªå…ˆåº¦**: é«˜  
**ä¾å­˜é–¢ä¿‚**: Phase 1å®Œäº†å¾Œ  
**æ‰€è¦æ™‚é–“**: 1-2æ™‚é–“

#### ã‚¿ã‚¹ã‚¯
- [ ] é€šå¹´è¨ˆç”»ã®å ´åˆã®ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ã®æ‰±ã„ã‚’æ±ºå®š
  - ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ–ï¼ˆé€šå¹´è¨ˆç”»ã§ã¯ä¸è¦ï¼‰
  - ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: è¨ˆç”»æœŸé–“ã‚’å»¶é•·ã™ã‚‹æ©Ÿèƒ½ã«å¤‰æ›´
  - ã‚ªãƒ—ã‚·ãƒ§ãƒ³3: è¨ˆç”»ã‚’è¤‡è£½ã™ã‚‹æ©Ÿèƒ½ã«å¤‰æ›´ï¼ˆæœŸé–“ã¯åŒã˜ï¼‰
- [ ] `copy`ãƒ¡ã‚½ãƒƒãƒ‰ã§`plan_year`ãŒ`null`ã®å ´åˆã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- [ ] æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ï¼ˆ`plan_year`ã‚ã‚Šï¼‰ã®ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ã¯ç¶­æŒ

#### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `app/controllers/plans_controller.rb`ï¼ˆ`copy`ãƒ¡ã‚½ãƒƒãƒ‰ï¼‰
- `app/services/plan_copier.rb`ï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰

---

### 2.5 APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å¤‰æ›´ ğŸŸ 

**å„ªå…ˆåº¦**: é«˜  
**ä¾å­˜é–¢ä¿‚**: Phase 1å®Œäº†å¾Œ  
**æ‰€è¦æ™‚é–“**: 1-2æ™‚é–“

#### ã‚¿ã‚¹ã‚¯
- [ ] `CultivationPlanApi#data`ã§`plan_year`ãŒ`null`ã®å ´åˆã®å‡¦ç†ã‚’è¿½åŠ 
- [ ] ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒ`plan_year`ã«ä¾å­˜ã—ã¦ã„ã‚‹å ´åˆã¯ã€å¾Œæ–¹äº’æ›æ€§ã®ãŸã‚`null`ã‚’è¿”ã™ã‹ã€æœŸé–“æƒ…å ±ã‚’è¿”ã™
- [ ] ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã€`plan_year`ã®ä½¿ç”¨ç®‡æ‰€ã‚’ä¿®æ­£ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰

#### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `app/controllers/concerns/cultivation_plan_api.rb`
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®JavaScriptãƒ•ã‚¡ã‚¤ãƒ«

---

### 2.6 ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãƒ»Presenterãƒ†ã‚¹ãƒˆ ğŸŸ 

**å„ªå…ˆåº¦**: é«˜  
**ä¾å­˜é–¢ä¿‚**: 2.1, 2.2å®Œäº†å¾Œ  
**æ‰€è¦æ™‚é–“**: 3-4æ™‚é–“

#### ã‚¿ã‚¹ã‚¯
- [ ] ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ãƒ†ã‚¹ãƒˆ
  - å¹´åº¦é¸æŠãªã—ã§è¨ˆç”»ã‚’ä½œæˆã§ãã‚‹ã“ã¨ã‚’ç¢ºèª
  - è¾²å ´åˆ¥ã«ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
  - æ—¢å­˜ã®è¨ˆç”»ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
  - ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®å¤‰æ›´ã‚’åæ˜ 
- [ ] Presenterã®ãƒ†ã‚¹ãƒˆ
  - `plans_by_farm`ãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒ†ã‚¹ãƒˆ
  - `plan_year`ãŒ`null`ã®è¨ˆç”»ã‚‚æ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

#### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `test/controllers/plans_controller_test.rb`
- `test/presenters/plans/index_presenter_test.rb`
- ãã®ä»–ã®Presenterãƒ†ã‚¹ãƒˆ

---

## ğŸŸ¡ ä¸­å„ªå…ˆåº¦ï¼ˆPhase 3: ãƒ“ãƒ¥ãƒ¼å±¤ï¼‰

### 3.1 ãƒ“ãƒ¥ãƒ¼å¤‰æ›´ ğŸŸ¡

**å„ªå…ˆåº¦**: ä¸­  
**ä¾å­˜é–¢ä¿‚**: Phase 2å®Œäº†å¾Œ  
**æ‰€è¦æ™‚é–“**: 3-4æ™‚é–“

#### ã‚¿ã‚¹ã‚¯
- [ ] `plans/index.html.erb`
  - å¹´åº¦åˆ¥è¡¨ç¤ºã‚’è¾²å ´åˆ¥è¡¨ç¤ºã«å¤‰æ›´
  - è¨ˆç”»æœŸé–“ã‚’è¡¨ç¤ºï¼ˆ`planning_start_date ã€œ planning_end_date`ï¼‰
  - `plan_year`ãŒ`null`ã®è¨ˆç”»ã‚‚æ­£ã—ãè¡¨ç¤º
- [ ] `plans/new.html.erb`
  - å¹´åº¦é¸æŠUIã‚’å‰Šé™¤
  - è¾²å ´é¸æŠã®ã¿è¡¨ç¤º
  - è¨ˆç”»åå…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯è¾²å ´åï¼‰
- [ ] `plans/show.html.erb`
  - é–‹å§‹æ—¥ãƒ»çµ‚äº†æ—¥ã®é¸æŠUIã‚’è¿½åŠ ï¼ˆPhase 4ã§ä½¿ç”¨ï¼‰
  - é¸æŠã—ãŸæœŸé–“ã‚’ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã«æ¸¡ã™

#### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `app/views/plans/index.html.erb`
- `app/views/plans/new.html.erb`
- `app/views/plans/show.html.erb`

---

### 3.2 ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚ºãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–° ğŸŸ¡

**å„ªå…ˆåº¦**: ä¸­  
**ä¾å­˜é–¢ä¿‚**: Phase 2å®Œäº†å¾Œ  
**æ‰€è¦æ™‚é–“**: 1-2æ™‚é–“

#### ã‚¿ã‚¹ã‚¯
- [ ] å…¨ã¦ã®ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚ºãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª
  - `config/locales/views/plans.ja.yml`
  - `config/locales/views/plans.us.yml`
  - `config/locales/views/plans.in.yml`
  - ãã®ä»–ã®è¨€èªãƒ•ã‚¡ã‚¤ãƒ«
- [ ] å¹´åº¦é–¢é€£ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æœŸé–“ãƒ™ãƒ¼ã‚¹ã«å¤‰æ›´ã™ã‚‹ã‹ã€æ¡ä»¶åˆ†å²ã‚’è¿½åŠ 
- [ ] è¨ˆç”»ã‚³ãƒ”ãƒ¼æ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æœŸé–“ãƒ™ãƒ¼ã‚¹ã«å¤‰æ›´

#### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `config/locales/views/plans.*.yml`

---

## ğŸŸ¢ ä½å„ªå…ˆåº¦ï¼ˆPhase 4: ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆæ©Ÿèƒ½ï¼‰

### 4.1 ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã®è¡¨ç¤ºç¯„å›²åˆ¶å¾¡ ğŸŸ¢

**å„ªå…ˆåº¦**: ä½  
**ä¾å­˜é–¢ä¿‚**: Phase 3å®Œäº†å¾Œ  
**æ‰€è¦æ™‚é–“**: 4-6æ™‚é–“

#### ã‚¿ã‚¹ã‚¯
- [ ] `custom_gantt_chart.js`: è¡¨ç¤ºç¯„å›²ã®åˆ¶å¾¡æ©Ÿèƒ½ã‚’è¿½åŠ 
  - é–‹å§‹æ—¥ãƒ»çµ‚äº†æ—¥ã®é¸æŠUI
  - é¸æŠã—ãŸæœŸé–“ã®ã¿è¡¨ç¤º
  - æ å¤–ã®ä½œä»˜ã®å‡¦ç†ï¼ˆè¡¨ç¤ºç¯„å›²å†…ã®ã¿è¡¨ç¤ºã€ç§»å‹•ä¸å¯ï¼‰
- [ ] `crop_palette_drag.js`: ãƒ‰ãƒ­ãƒƒãƒ—æ™‚ã®ç¯„å›²ãƒã‚§ãƒƒã‚¯
- [ ] ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã®åˆ¶é™ãƒ­ã‚¸ãƒƒã‚¯
  - è¡¨ç¤ºç¯„å›²å†…ã®ä½œä»˜: ç§»å‹•å¯èƒ½
  - æ å¤–ã«ã‹ã‹ã‚‹ä½œä»˜: ç§»å‹•ä¸å¯ï¼ˆè¡¨ç¤ºç¯„å›²å†…ã®ã¿è¡¨ç¤ºï¼‰

#### å®Ÿè£…ãƒ­ã‚¸ãƒƒã‚¯
```javascript
// è¡¨ç¤ºç¯„å›²ã®è¨­å®š
window.ganttState.displayStartDate = selectedStartDate;
window.ganttState.displayEndDate = selectedEndDate;

// ä½œä»˜ã®è¡¨ç¤ºåˆ¤å®š
function shouldDisplayCultivation(cultivation) {
  const { start_date, completion_date } = cultivation;
  const { displayStartDate, displayEndDate } = window.ganttState;
  
  // è¡¨ç¤ºç¯„å›²ã¨é‡è¤‡ã—ã¦ã„ã‚‹ã‹
  return !(completion_date < displayStartDate || start_date > displayEndDate);
}

// ç§»å‹•åˆ¶é™ã®åˆ¤å®š
function isMovable(cultivation) {
  const { start_date, completion_date } = cultivation;
  const { displayStartDate, displayEndDate } = window.ganttState;
  
  // è¡¨ç¤ºç¯„å›²å†…ã«å®Œå…¨ã«åã¾ã£ã¦ã„ã‚‹ã‹
  return start_date >= displayStartDate && completion_date <= displayEndDate;
}
```

#### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `app/assets/javascripts/custom_gantt_chart.js`
- `app/assets/javascripts/crop_palette_drag.js`

---

### 4.2 APIå¤‰æ›´ ğŸŸ¢

**å„ªå…ˆåº¦**: ä½  
**ä¾å­˜é–¢ä¿‚**: 4.1å®Œäº†å¾Œ  
**æ‰€è¦æ™‚é–“**: 1-2æ™‚é–“

#### ã‚¿ã‚¹ã‚¯
- [ ] `Api::V1::Plans::CultivationPlansController#data`: è¡¨ç¤ºç¯„å›²ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹
- [ ] è¡¨ç¤ºç¯„å›²å†…ã®ä½œä»˜ã®ã¿è¿”ã™ï¼ˆã¾ãŸã¯å…¨ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã—ã¦ãƒ•ãƒ­ãƒ³ãƒˆã§ãƒ•ã‚£ãƒ«ã‚¿ï¼‰
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è€ƒæ…®ã—ãŸå®Ÿè£…ï¼ˆå¤§é‡ãƒ‡ãƒ¼ã‚¿ã®å ´åˆï¼‰

#### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `app/controllers/api/v1/plans/cultivation_plans_controller.rb`

---

### 4.3 çµ±åˆãƒ»ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ ğŸŸ¢

**å„ªå…ˆåº¦**: ä½  
**ä¾å­˜é–¢ä¿‚**: Phase 4å®Œäº†å¾Œ  
**æ‰€è¦æ™‚é–“**: 3-4æ™‚é–“

#### ã‚¿ã‚¹ã‚¯
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆ
  - æ–°è¦ä½œæˆãƒ•ãƒ­ãƒ¼ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª
  - è¡¨ç¤ºç¯„å›²ã®é¸æŠãŒã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã«åæ˜ ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
  - æ å¤–ã®ä½œä»˜ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
- [ ] ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¨ˆç”»ã‚’ä½œæˆãƒ»ç·¨é›†ã§ãã‚‹ã“ã¨ã‚’ç¢ºèª
  - è¡¨ç¤ºç¯„å›²ã®é¸æŠãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª
  - ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã®åˆ¶é™ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª

#### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `test/integration/plans_test.rb`
- `test/system/plans_test.rb`

---

## ğŸ“… å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆæ¨å¥¨ï¼‰

### Week 1: åŸºç›¤å®Ÿè£…
- Day 1-2: Phase 1.1 ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…
- Day 3: Phase 1.2 ãƒ¢ãƒ‡ãƒ«å¤‰æ›´
- Day 4: Phase 1.3 ãƒ¢ãƒ‡ãƒ«ãƒ†ã‚¹ãƒˆ
- Day 5: Phase 1.4 ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ•´ç†

### Week 2: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤
- Day 1: Phase 2.0 PlanSaveServiceå¤‰æ›´
- Day 2-3: Phase 2.1 PlansControllerå¤‰æ›´
- Day 4: Phase 2.2 Presenterå¤‰æ›´
- Day 5: Phase 2.3 PlanningSchedulesControllerå¤‰æ›´

### Week 3: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤ï¼ˆç¶šãï¼‰
- Day 1: Phase 2.4 PlanCopierå¤‰æ›´
- Day 2: Phase 2.5 APIãƒ¬ã‚¹ãƒãƒ³ã‚¹å¤‰æ›´
- Day 3-4: Phase 2.6 ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãƒ»Presenterãƒ†ã‚¹ãƒˆ

### Week 4: ãƒ“ãƒ¥ãƒ¼å±¤
- Day 1-2: Phase 3.1 ãƒ“ãƒ¥ãƒ¼å¤‰æ›´
- Day 3: Phase 3.2 ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚ºãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°

### Week 5: ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆæ©Ÿèƒ½
- Day 1-3: Phase 4.1 ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã®è¡¨ç¤ºç¯„å›²åˆ¶å¾¡
- Day 4: Phase 4.2 APIå¤‰æ›´
- Day 5: Phase 4.3 çµ±åˆãƒ»ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ

---

## âš ï¸ ãƒªã‚¹ã‚¯ç®¡ç†

### é«˜ãƒªã‚¹ã‚¯é …ç›®

1. **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ™‚ã®ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§**
   - ãƒªã‚¹ã‚¯: æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã§é‡è¤‡ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§
   - å¯¾ç­–: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å‰ã«å¿…ãšé‡è¤‡ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿæ–½

2. **æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¨æ–°è¦ãƒ‡ãƒ¼ã‚¿ã®æ··åœ¨**
   - ãƒªã‚¹ã‚¯: è¡¨ç¤ºã‚„æ¤œç´¢ãƒ­ã‚¸ãƒƒã‚¯ãŒè¤‡é›‘ã«ãªã‚‹
   - å¯¾ç­–: æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®`plan_year`ã‚’ä¿æŒã—ã€æ–°è¦ãƒ‡ãƒ¼ã‚¿ã¯`null`ã«ã™ã‚‹æ–¹é‡ã‚’ç¶­æŒ

3. **PlanningSchedulesControllerã¸ã®å½±éŸ¿**
   - ãƒªã‚¹ã‚¯: `plan_year`ã«å¼·ãä¾å­˜ã—ã¦ã„ã‚‹ãŸã‚ã€å¤‰æ›´ç¯„å›²ãŒå¤§ãã„
   - å¯¾ç­–: æ®µéšçš„ã«å®Ÿè£…ã—ã€æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¨ã®äº’æ›æ€§ã‚’ä¿ã¤

### ä¸­ãƒªã‚¹ã‚¯é …ç›®

1. **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®JavaScriptä¾å­˜**
   - ãƒªã‚¹ã‚¯: `plan_year`ã‚’æœŸå¾…ã—ã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚‹å¯èƒ½æ€§
   - å¯¾ç­–: APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§`null`ã‚’è¿”ã—ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§å¯¾å¿œ

2. **ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®æ›´æ–°æ¼ã‚Œ**
   - ãƒªã‚¹ã‚¯: ä¸€éƒ¨ã®ãƒ†ã‚¹ãƒˆãŒæ›´æ–°ã•ã‚Œãšã€å¾Œã§å•é¡ŒãŒç™ºè¦š
   - å¯¾ç­–: å„ãƒ•ã‚§ãƒ¼ã‚ºã§å¿…ãšãƒ†ã‚¹ãƒˆã‚’æ›´æ–°

---

## âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 1å®Œäº†æ™‚
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ­£å¸¸ã«å®Ÿè¡Œã§ãã‚‹
- [ ] æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãŒæ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã‚‹
- [ ] æ–°è¦ãƒ‡ãƒ¼ã‚¿ï¼ˆ`plan_year`ãŒ`null`ï¼‰ãŒæ­£å¸¸ã«ä½œæˆã§ãã‚‹
- [ ] ä¸€æ„åˆ¶ç´„ãŒæ­£ã—ãæ©Ÿèƒ½ã™ã‚‹
- [ ] ãƒ¢ãƒ‡ãƒ«ãƒ†ã‚¹ãƒˆãŒå…¨ã¦é€šéã™ã‚‹

### Phase 2å®Œäº†æ™‚
- [ ] å¹´åº¦é¸æŠãªã—ã§è¨ˆç”»ã‚’ä½œæˆã§ãã‚‹
- [ ] è¾²å ´åˆ¥ã«ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] æ—¢å­˜ã®è¨ˆç”»ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] PlanningSchedulesControllerãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹
- [ ] ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãƒ»Presenterãƒ†ã‚¹ãƒˆãŒå…¨ã¦é€šéã™ã‚‹

### Phase 3å®Œäº†æ™‚
- [ ] ãƒ“ãƒ¥ãƒ¼ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] å¹´åº¦é¸æŠUIãŒå‰Šé™¤ã•ã‚Œã¦ã„ã‚‹
- [ ] è¾²å ´åˆ¥è¡¨ç¤ºãŒæ­£ã—ãå‹•ä½œã™ã‚‹
- [ ] ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹

### Phase 4å®Œäº†æ™‚
- [ ] ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã®è¡¨ç¤ºç¯„å›²åˆ¶å¾¡ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹
- [ ] æ å¤–ã®ä½œä»˜ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã®åˆ¶é™ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹
- [ ] çµ±åˆãƒ»ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆãŒå…¨ã¦é€šéã™ã‚‹

---

## ğŸ“ å‚™è€ƒ

- å„ãƒ•ã‚§ãƒ¼ã‚ºã§å¿…ãšãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã—ã€å•é¡ŒãŒãªã‘ã‚Œã°æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚ºã«é€²ã‚€
- æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«ã€ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã§ååˆ†ãªãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½
- æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¨ã®å¾Œæ–¹äº’æ›æ€§ã‚’å¸¸ã«æ„è­˜ã™ã‚‹
- ä¸æ˜ãªç‚¹ã‚„å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€è¨­è¨ˆæ›¸ã‚’å‚ç…§ã—ã€å¿…è¦ã«å¿œã˜ã¦è¨­è¨ˆã‚’è¦‹ç›´ã™

