# 圃場追加・削除機能 - 動作確認チェックリスト

## 準備
- [ ] `docker compose up` でサーバー起動
- [ ] ブラウザで http://localhost:3000 を開く
- [ ] 作付け計画を作成して結果画面に移動

## ブラウザコンソールで確認

F12キーで開発者ツールを開き、Consoleタブで以下を実行：

### 初期状態の確認
```javascript
// 状態を確認
debugState()

// field_id形式を確認（すべて"field_123"形式であるべき）
debugFieldIds()

// 期待される出力:
// ✅ すべてのfield_idが正しい形式です（"field_123"）
```

## 機能テスト

### 1. 圃場追加
- [ ] 緑色の「+ 圃場追加」ボタンが表示されている
- [ ] ボタンをクリックするとプロンプトが表示される
- [ ] 圃場名「圃場5」、面積「150」を入力
- [ ] 「圃場を追加中...」が表示される
- [ ] 新しい圃場の行がガントチャートに追加される
- [ ] コンソールで `debugFieldIds()` を実行 → すべて✅

### 2. 圃場削除
- [ ] 空の圃場に赤い×ボタンが表示される
- [ ] ×ボタンをクリックすると確認ダイアログが表示される
- [ ] 「OK」をクリック
- [ ] 「圃場を削除中...」が表示される
- [ ] 圃場がガントチャートから削除される
- [ ] コンソールで `debugFieldIds()` を実行 → すべて✅

### 3. ドラッグ&ドロップ（互換性確認）
- [ ] 作物パレットを開く
- [ ] 作物を圃場にドラッグ&ドロップ
- [ ] 「最適化処理中...」が表示される
- [ ] 作物が正常に追加される
- [ ] エラーが表示されない
- [ ] コンソールにエラーログがない

### 4. 作物の移動（互換性確認）
- [ ] 既存の作物をドラッグ
- [ ] 別の圃場にドロップ
- [ ] 「最適化処理中...」が表示される
- [ ] 作物が正常に移動される
- [ ] エラーが表示されない
- [ ] コンソールで `debugState()` → movesが正しい形式

## エラーケースの確認

### 面積バリデーション
- [ ] 圃場追加で面積に`-10`を入力
- [ ] 「有効な面積を入力してください」アラートが表示される

### 作物がある圃場の削除
- [ ] 作物がある圃場には×ボタンが表示されない

### 最後の圃場の削除
- [ ] 圃場が1つだけの場合、×ボタンが表示されない

## 統合シナリオ

### シナリオ1: 追加 → ドロップ → 削除
1. [ ] 圃場を追加
2. [ ] その圃場に作物をドロップ
3. [ ] 作物を削除
4. [ ] 空になった圃場を削除
5. [ ] すべて正常に動作

### シナリオ2: 複数圃場の管理
1. [ ] 圃場を3つ追加
2. [ ] それぞれに作物をドロップ
3. [ ] 作物を移動
4. [ ] 空の圃場を削除
5. [ ] すべて正常に動作

## 最終確認

コンソールで実行：
```javascript
// すべてのfield_idが正しい形式か確認
ganttState.fieldGroups.every(g => 
  typeof g.fieldId === 'string' && 
  g.fieldId.startsWith('field_')
)
// 期待される結果: true

// 完全な状態を出力
debugState()
```

---

## 問題が発生した場合

### コンソールログを確認
```javascript
// エラーログを確認
console.error.bind(console)

// field_idの形式を確認
ganttState.fieldGroups.map(g => ({
  name: g.fieldName,
  id: g.fieldId,
  type: typeof g.fieldId,
  valid: typeof g.fieldId === 'string' && g.fieldId.startsWith('field_')
}))
```

### サーバーログを確認
```bash
docker compose logs web --tail=100 | grep -A 10 "ERROR\|500"
```

### キャッシュをクリア
ブラウザで `Ctrl + Shift + R`（強制リロード）

---

## 成功条件

✅ 圃場追加ボタンが表示され、クリック可能
✅ 圃場を追加すると画面に反映される
✅ 空の圃場に削除ボタンが表示される
✅ 削除ボタンで圃場を削除できる
✅ 作物のドラッグ&ドロップが正常に動作
✅ すべてのfield_idが"field_123"形式
✅ コンソールにエラーがない

