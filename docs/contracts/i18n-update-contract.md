# Feature Contract: i18n-update

**作成日**: 2026-02-09  
**作成者**: AIアシスタント（代理作業）  
**機能概要**: フロントエンド（Angular）内の直接表記・ハードコードされた表示文言を翻訳キーへ置換し、アクセシビリティ属性やテスト期待値を含めた i18n 対応を行う。  
**ステータス**: draft

## ビジネス要件

- アプリ内のすべてのユーザー向け表示文言を翻訳可能にすることで、多言語対応を実現する。  
- 日本語（既存）と英語（en）を最低限サポートする。  
- 既存のUI表示や機能に影響を与えない（表示ロジックは保持）。  
- テスト（ユニット/spec）およびE2Eの期待値を翻訳に合わせて更新する。

## 技術要件

- 翻訳ファイル: `frontend/src/assets/i18n/ja.json`, `frontend/src/assets/i18n/en.json` を更新/追加する。  
- テンプレート内の直接文字列は `{{ 'key' | translate }}` または `i18n` 属性へ置換する。  
- TypeScript 内の表示文字列は `this.translate.instant('key')` またはコンポーネントでキーを受けて表示する。  
- aria-label 等は `[attr.aria-label]="'key' | translate"` に置換する。  
- テストでは、翻訳キーをロードして期待値を検証するか、テスト内文字列を翻訳キーに置換する。  
- 変更は段階的にPR化し、各PRは UI スモークテストを含む。

## Use Case: i18n 化（UI表示テキストの置換）

### 概要
フロントエンドの各コンポーネントで直書きされている表示文言を翻訳キーに置換し、翻訳ファイルに対応するキーを追加する。

### アクター
- Primary Actor: フロントエンド開発者  
- Supporting Actors: テスター、翻訳レビュアー

### 事前条件
- 既存のビルドとテストが通ること。  
- `@ngx-translate/core` が既に導入済みであること（本リポジトリは導入済み）。

### 基本フロー
1. 対象ファイル群（テンプレート・inline template・TS・spec）をスキャンして直書き文言を列挙する（既にスキャン済み）。  
2. 翻訳キー命名規則に従ってキーを作成し、`ja.json` と `en.json` に追加（暫定訳を入れる）。  
3. テンプレートの文字列を `{{ 'key' | translate }}` または `i18n` 属性へ置換。  
4. TS 内の文字列は `this.translate.instant('key')` に置換。  
5. aria-label 等アクセシビリティ属性は翻訳キーへ置換。  
6. spec ファイルの期待値を翻訳に合わせて修正、またはテスト側で翻訳ロードを行う。  
7. 各PRごとにテスト（unit/test-common）と簡易UI確認を実施。

### 代替フロー
- 一部コンテンツ（外部データやデータベース由来の文言）はバックエンド側で国際化される場合、フロントはキー受け渡しのみを行う。

### 事後条件
- UI 表示が翻訳キー経由で表示されるようになる。  
- 翻訳ファイルにキーが存在しない場合はフォールバックが発生し、翻訳レビュープロセスで補完される。

## API仕様

（本作業は主にフロントエンド側の変更のため、API 仕様の変更は想定しない。サーバー側で返す文言を多言語化する必要が生じた場合は別途契約を作成する。）

## データモデル

（なし）

## 実装タスク

### Phase 1: 契約作成（本ファイル）
- [x] docs/contracts/i18n-update-contract.md を作成

### Phase 2: フロントエンド実装（並列可能）
- [ ] add_keys: `frontend/src/assets/i18n/ja.json` と `en.json` にキー追加（暫定訳）  
- [ ] template_replace: テンプレートと inline template の置換（`{{ 'key' | translate }}` / `i18n`）  
- [ ] ts_replace: TypeScript 内の表示文字列を `this.translate.instant('key')` へ置換  
- [ ] aria_fix: aria-label 等の属性置換  
- [ ] tests: spec の期待値を修正または翻訳ロードを追加

### Phase 3: レビュー・マージ
- [ ] 翻訳レビューワークフロー（翻訳者による確認）  
- [ ] UI スモークテスト（ステージ）  
- [ ] 翻訳ファイルの最終版反映

## レビューポイント
- 主要なユーザー向け文言がすべて翻訳キーへ置換されているか  
- テストが翻訳変更に合わせて更新されているか  
- aria-label 等アクセシビリティ属性が翻訳可能になっているか  
- 既存の表示ロジックが壊れていないか（回帰確認）

## 変更履歴
| Date | Version | Author | Changes |
|------|---------|--------|---------|
| 2026-02-09 | 0.1 | AIアシスタント | Initial draft for i18n update contract |

---

Phase1（契約作成）は完了しました。Phase2（実装：テンプレート/TS の置換、翻訳キー追加等）に進めてよいですか？進める場合、並列で実行するサブエージェントは `presenter-frontend`, `gateway-frontend`, `controller-frontend`（必要な箇所のみ）および `test-common` を想定しています。

