# 数年に渡る作付け計画画面 設計書

## 📋 概要

現在の計画画面（ガントチャート形式：横軸=時間、縦軸=ほ場）とは異なる、**数年に渡る作付け計画画面**の設計。

### 要件
- **農場・ほ場選択機能**: 農場を選択し、その農場のほ場を選択（デフォルトで全選択）
- **横軸**: ほ場（選択したほ場を列として表示）
- **縦軸**: 月（4半期くらいの粒度）
- **期間**: 年度ごとに表示（デフォルト：今年から5年分、年度ナビゲーションで前後移動可能）

## 🎯 画面構成

### 1. ほ場選択画面（新規）

#### 機能
- 農場を選択
- 選択した農場のほ場を一覧表示（デフォルトで全選択）
- 選択した農場のほ場で計画表を表示
- 年度は今年から5年分をデフォルト表示

#### 表示データ
- 農場一覧（選択可能）
- 選択した農場のほ場一覧（チェックボックス、デフォルトで全選択）
- ほ場名、ほ場面積

#### 画面レイアウト
```
┌─────────────────────────────────────────────────────────────┐
│  📅 ほ場選択                                                  │
├─────────────────────────────────────────────────────────────┤
│  農場選択: [農場A ▼]                                         │
│                                                              │
│  ほ場選択（デフォルトで全選択）:                              │
│  ☑ ほ場1 (1000㎡)                                            │
│  ☑ ほ場2 (2000㎡)                                            │
│  ☑ ほ場3 (1500㎡)                                            │
│                                                              │
│  表示期間: 2024年度 〜 2028年度（今年から5年分）              │
│                                                              │
│  [選択したほ場で計画表を表示] ボタン                          │
└─────────────────────────────────────────────────────────────┘
```

#### UXの利点
- **シンプルな操作**: 農場を選ぶだけですぐに開始できる
- **デフォルト全選択**: ほ場はデフォルトで全選択されているため、そのまま進めることが多い
- **必要に応じて調整**: 不要なほ場だけチェックを外せばよい

### 2. 作付け計画表画面（新規）

#### 機能
- 選択したほ場を横軸（列）として表示
- 月/四半期を縦軸（行）として表示
- 数年に渡る期間を表示（デフォルト：現在年から5年後まで）
- 各セルに作付け情報（作物名、期間）を表示
- 年度の前後移動（「前」「次」ボタンで年度を移動）

#### 画面レイアウト（例：四半期表示）
```
┌─────────────────────────────────────────────────────────────┐
│  📊 作付け計画表                                              │
├─────────────────────────────────────────────────────────────┤
│  [ほ場選択] [← 2024年度 →] [表示粒度: 四半期▼]              │
├──────────┬──────────┬──────────┬──────────┬──────────┐
│ 期間     │ ほ場1    │ ほ場2    │ ほ場3    │ ほ場A    │
│          │ (農場A)  │ (農場A)  │ (農場A)  │ (農場B)  │
├──────────┼──────────┼──────────┼──────────┼──────────┤
│ 2024 Q1  │ [トマト] │ [キャベツ]│          │          │
│          │ 1/15-    │ 2/1-     │          │          │
│          │ 3/20     │ 4/30     │          │          │
├──────────┼──────────┼──────────┼──────────┼──────────┤
│ 2024 Q2  │ [ナス]   │          │ [レタス] │          │
│          │ 4/1-     │          │ 5/1-     │          │
│          │ 6/30     │          │ 6/30     │          │
├──────────┼──────────┼──────────┼──────────┼──────────┤
│ 2024 Q3  │          │ [トウモロコシ]│      │          │
│          │          │ 7/1-     │          │          │
│          │          │ 9/30     │          │          │
├──────────┼──────────┼──────────┼──────────┼──────────┤
│ 2024 Q4  │ [ブロッコリー]│      │          │          │
│          │ 10/1-    │          │          │          │
│          │ 12/20    │          │          │          │
└──────────┴──────────┴──────────┴──────────┴──────────┘
```
（「次」ボタンをクリックすると2025年度に移動）

#### 表示粒度オプション
- **月**: 1月、2月、3月...（12行/年）
- **四半期**: Q1、Q2、Q3、Q4（4行/年）
- **半期**: 上半期、下半期（2行/年）

#### 年度ナビゲーション
- 「前」「次」ボタンで年度を前後に移動
- デフォルト：今年度を表示
- 表示可能範囲：今年から5年分（選択画面で設定した期間内）
- 1年度分のデータのみを表示（例：2024年度を選択した場合、2024年1月〜12月のみ表示）

## 📊 データモデル

### 既存モデル
- `CultivationPlan`: 計画（年度単位）
- `CultivationPlanField`: 計画内のほ場
- `FieldCultivation`: ほ場ごとの栽培（開始日、終了日、作物）

### データ要件

#### ほ場選択画面で必要なデータ
- ユーザーが所有する農場一覧
- 選択した農場のほ場一覧（全計画から集約）
- ほ場の識別情報（ほ場名、面積）
- 表示期間（デフォルト：今年から5年分）

#### 作付け計画表画面で必要なデータ
- 選択されたほ場の一覧
- 各ほ場に紐づく栽培情報（開始日、終了日、作物名、面積、年度）
- 表示年度（現在表示している年度）
- 表示期間（選択した年度の1年間）
- 表示粒度（月/四半期/半期）

### データ構造の概念

#### ほ場選択画面のデータ構造
```
選択農場: 農場A
  ほ場一覧:
    - ほ場1 (1000㎡) [デフォルトでチェック]
    - ほ場2 (2000㎡) [デフォルトでチェック]
    - ほ場3 (1500㎡) [デフォルトでチェック]
  
  表示期間: 2024年度 〜 2028年度（今年から5年分）
```

#### 作付け計画表のデータ構造
- **横軸（列）**: 選択されたほ場（各列はほ場名・農場情報を持つ）
- **縦軸（行）**: 期間（月/四半期/半期単位、選択した年度の1年間）
- **セル**: 該当期間に該当する栽培情報（複数の栽培が期間を跨ぐ場合は複数表示）
- **年度ナビゲーション**: 「前」「次」ボタンで年度を移動（例：2024年度 → 2025年度）
- 列のラベル例: "ほ場1 (農場A)"

## 🎨 UI/UX設計

### ほ場選択画面のUI要件
- 農場選択ドロップダウン
- 選択した農場のほ場一覧（チェックボックス形式）
- ほ場はデフォルトで全選択
- 全選択/全解除機能
- 選択したほ場の数を表示
- 表示期間の表示（今年から5年分）
- 計画表表示への遷移ボタン

### 作付け計画表画面のUI要件
- テーブル形式のレイアウト
- 横スクロール対応（ほ場が多い場合）
- 縦スクロール対応（期間が長い場合）
- 固定ヘッダー（ほ場名・期間ラベル）
- セル内の栽培情報の視認性
- 年度ナビゲーション（「前」「次」ボタンで年度を移動）
- 表示粒度切り替えUI（月/四半期/半期）
- ほ場再選択への遷移
- 現在表示している年度の表示

### セル内の表示内容
- 作物名
- 作付け期間（開始日〜終了日）
- 面積（オプション）
- 複数の栽培が期間を跨ぐ場合は複数表示または統合表示

## 📝 国際化（i18n）

### 必要な翻訳キー
```yaml
# config/locales/views/plans.ja.yml
plans:
  fields_selection:
    title: "ほ場選択"
    subtitle: "作付け計画表に表示するほ場を選択してください"
    farm_label: "農場選択"
    fields_label: "ほ場選択（デフォルトで全選択）"
    period_label: "表示期間"
    period_default: "今年から5年分"
    select_all: "すべて選択"
    deselect_all: "すべて解除"
    show_schedule: "選択したほ場で計画表を表示"
    no_fields: "ほ場がありません"
  schedule:
    title: "作付け計画表"
    subtitle: "数年に渡る作付け計画を確認"
    field_label: "ほ場"
    period_label: "期間"
    year_navigation:
      previous: "前"
      next: "次"
    granularity:
      month: "月"
      quarter: "四半期"
      half: "半期"
    no_cultivation: "作付けなし"
```

## 🧪 テスト方針

### テスト対象
- ほ場選択画面の表示
- 農場選択の動作
- ほ場のデフォルト全選択
- ほ場の選択/解除機能
- 作付け計画表画面の表示
- ほ場未選択時のエラーハンドリング
- 年度ナビゲーション（前/次）の動作
- 表示粒度切り替えの動作
- ほ場選択 → 計画表表示のフロー

## 📌 注意事項

### データ整合性
- 選択した農場のほ場は、全計画から集約して表示する
- 同じほ場名が複数の計画に存在する場合でも、1つのほ場として扱う
- 作付け計画表では、年度ごとに表示を切り替えるため、各年度の計画データを適切に取得する必要がある

### パフォーマンス
- 年度ごとに表示を切り替えるため、1年度分のデータのみを表示する
- 年度ナビゲーション時は、必要な年度のデータのみを取得する
- 必要に応じてデータのキャッシュを検討

### 既存機能との関係
- 既存のガントチャート画面（`plans#show`）とは独立した画面
- 既存の計画作成フローには影響しない

## 🔄 将来の拡張

### 検討事項
- 計画表からの直接編集機能
- ほ場の並び替え機能
- フィルタリング機能（作物別、農場別）
- エクスポート機能（CSV、PDF）
- 印刷対応

