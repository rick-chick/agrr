# DEPRECATED: This file is for reference only
# The aws-deploy.sh script now uses ECR-based deployment with CLI parameters
# instead of this YAML configuration file.
#
# For ECR-based deployment, use:
#   ./scripts/aws-deploy.sh production deploy
#
# If you want to use this YAML file manually for source-based deployment:
# 1. Push your code to GitHub
# 2. Create GitHub connection in App Runner
# 3. Use this as apprunner.yaml in your repository root
#
# NOTE: ECR-based deployment is recommended for better control and CI/CD integration.

version: 1.0

# ECR Image Repository Configuration (Recommended)
# Use this structure if deploying from ECR manually via AWS CLI or Console
source:
  image-repository:
    image-identifier: ${ACCOUNT_ID}.dkr.ecr.${REGION}.amazonaws.com/agrr:latest
    image-repository-type: ECR
    image-configuration:
      port: 3000
      runtime-environment-variables:
        - name: RAILS_ENV
          value: production
        - name: RAILS_MASTER_KEY
          value: ${RAILS_MASTER_KEY}
        - name: RAILS_SERVE_STATIC_FILES
          value: "true"
        - name: RAILS_LOG_TO_STDOUT
          value: "true"
        - name: AWS_REGION
          value: ${AWS_REGION}
        - name: AWS_S3_BUCKET
          value: ${AWS_S3_BUCKET}
        - name: ALLOWED_HOSTS
          value: ${ALLOWED_HOSTS}

# Instance Configuration
instance-configuration:
  cpu: 1024
  memory: 2048
  instance-role-arn: ${IAM_ROLE_ARN}

# Health Check Configuration
health-check-configuration:
  protocol: HTTP
  path: /up
  interval: 10
  timeout: 5
  healthy-threshold: 1
  unhealthy-threshold: 5

# Notes:
# - Replace ${VARIABLE} placeholders with actual values
# - Get values from .env.aws file generated by setup-aws-resources.sh
# - For automated deployment, use ./scripts/aws-deploy.sh instead
