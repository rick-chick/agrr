<%# app/views/shared/_crop_palette.html.erb %>
<%# ä½œç‰©ãƒ‘ãƒ¬ãƒƒãƒˆï¼ˆã‚µã‚¤ãƒ‰ãƒ‘ãƒãƒ«ï¼‰ %>
<%# é¸æŠžå¯èƒ½ãªä½œç‰©ã‚’ã‚«ãƒ¼ãƒ‰ã§è¡¨ç¤ºã—ã€ãƒ‰ãƒ©ãƒƒã‚°ã§ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã«è¿½åŠ ã§ãã‚‹ %>

<%
  # ç¾åœ¨ã®è¨ˆç”»ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ä½œç‰©
  used_crop_ids = cultivation_plan.cultivation_plan_crops.map { |cpc| cpc.crop&.id }.compact
  
  # åœ°åŸŸã®å‚ç…§ä½œç‰©ã‚’å–å¾—
  if cultivation_plan.plan_type == 'public'
    # å…¬é–‹è¨ˆç”»ï¼šåŒã˜åœ°åŸŸã®å‚ç…§ä½œç‰©
    available_crops = Crop.reference.where(region: cultivation_plan.farm.region).order(:name)
  else
    # å€‹äººè¨ˆç”»ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œç‰©
    available_crops = cultivation_plan.user.crops.where(is_reference: false).order(:name)
  end
%>

<%# ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚³ãƒ³ãƒ†ãƒŠï¼ˆæ ½åŸ¹ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å³ä¸Šã«é…ç½®ï¼‰ %>
<div class="crop-palette-container">
  <%# ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒœã‚¿ãƒ³ %>
  <button class="crop-palette-toggle-btn" id="crop-palette-toggle" aria-label="<%= crop_palette_toggle_label || 'ä½œç‰©ã‚’è¿½åŠ ' %>">
    <span class="crop-palette-icon">ðŸŒ±</span>
    <span class="toggle-text"><%= crop_palette_title || 'ä½œç‰©ã‚’è¿½åŠ ' %></span>
    <span class="toggle-icon">â–¼</span>
  </button>
  
  <%# ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ‘ãƒãƒ« %>
  <div class="crop-palette-panel" id="crop-palette-panel">
    <div class="crop-palette-body">
      <div class="crop-palette-grid">
        <% available_crops.each do |crop| %>
          <div class="crop-palette-card" 
               data-crop-id="<%= crop.id %>"
               data-crop-name="<%= crop.name %>"
               data-crop-variety="<%= crop.variety %>">
            <!-- ã‚¬ãƒ³ãƒˆã‚«ãƒ¼ãƒ‰ã¨åŒã˜ã‚¹ã‚¿ã‚¤ãƒ«ã®ãƒãƒ¼ -->
            <div class="crop-card-bar">
              <span class="crop-card-label"><%= crop.name %></span>
              <% if used_crop_ids.include?(crop.id) %>
                <span class="crop-card-badge"><%= crop_palette_in_use_label || 'ä½¿ç”¨ä¸­' %></span>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

