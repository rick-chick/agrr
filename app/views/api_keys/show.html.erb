<div class="page-header">
  <h1><%= t('api_keys.title') %></h1>
</div>

<div class="card">
  <div class="card__body">
    <p class="text-muted"><%= t('api_keys.description_html').html_safe %></p>

    <% if current_user.has_api_key? %>
      <div class="form-group">
        <label for="api_key"><%= t('api_keys.label') %></label>
        <div class="input-group">
          <input 
            type="text" 
            id="api_key" 
            class="form-control" 
            value="<%= current_user.api_key %>" 
            readonly
            data-controller="copy-to-clipboard"
            data-copy-to-clipboard-target="source"
          >
          <button 
            type="button" 
            class="btn btn-secondary"
            data-action="click->copy-to-clipboard#copy"
            data-copy-to-clipboard-target="button"
            data-copy-to-clipboard-success-label="<%= t('api_keys.copy.success') %>"
            data-copy-to-clipboard-failure-label="<%= t('api_keys.copy.failure') %>"
            data-copy-to-clipboard-fallback-label="<%= t('api_keys.copy.fallback') %>"
          >
            <%= t('api_keys.copy.button') %>
          </button>
        </div>
        <small class="form-text text-muted">
          <%= t('api_keys.warning') %>
        </small>
      </div>

      <div class="form-group">
        <%= button_to t('api_keys.actions.regenerate'), regenerate_api_key_path, 
            method: :post, 
            class: "btn btn-warning",
            data: { 
              confirm: t('api_keys.actions.regenerate_confirm')
            } %>
      </div>
    <% else %>
      <div class="alert alert-info">
        <p><%= t('api_keys.notices.missing') %></p>
      </div>

      <div class="form-group">
        <%= button_to t('api_keys.actions.generate'), generate_api_key_path, 
            method: :post, 
            class: "btn btn-primary" %>
      </div>
    <% end %>
  </div>
</div>

<div class="card mt-4">
  <div class="card__header">
    <h2><%= t('api_keys.usage.heading') %></h2>
  </div>
  <div class="card__body">
    <h3><%= t('api_keys.usage.headers.header') %></h3>
    <pre class="code-block"><code>X-API-Key: <%= current_user.api_key if current_user.has_api_key? %></code></pre>
    <p><%= t('api_keys.usage.headers.or') %></p>
    <pre class="code-block"><code>Authorization: Bearer <%= current_user.api_key if current_user.has_api_key? %></code></pre>

    <h3 class="mt-4"><%= t('api_keys.usage.query.heading') %></h3>
    <pre class="code-block"><code>GET /api/v1/masters/crops?api_key=<%= current_user.api_key if current_user.has_api_key? %></code></pre>

    <div class="mt-4">
      <%= link_to t('api_keys.usage.reference_button'), api_docs_path, target: "_blank", class: "btn btn-primary" %>
    </div>

    <h3 class="mt-4"><%= t('api_keys.usage.endpoints.heading') %></h3>
    <%= t('api_keys.usage.endpoints.list_html').html_safe %>
  </div>
</div>
