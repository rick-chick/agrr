<% content_for :title, "#{@pest.name} - AGRR" %>

<div class="crop-detail-card" id="<%= dom_id(@pest) %>" data-undo-delete-record>
  <div class="crop-detail-header">
    <h1 class="crop-detail-title"><%= @pest.name %></h1>
    <% if admin_user? && @pest.is_reference %>
      <div class="crop-detail-type reference"><%= t('.reference_pest') %></div>
    <% end %>
  </div>
  
  <div class="crop-basic-info">
    <div class="info-item">
      <span class="info-label">üÜî <%= t('.pest_id') %>:</span>
      <span class="info-value"><%= @pest.id %></span>
    </div>
    
    <div class="info-item">
      <span class="info-label">üìù <%= t('.name') %>:</span>
      <span class="info-value"><%= @pest.name %></span>
    </div>
    
    <% if @pest.name_scientific.present? %>
      <div class="info-item">
        <span class="info-label">üî¨ <%= t('.name_scientific') %>:</span>
        <span class="info-value"><%= @pest.name_scientific %></span>
      </div>
    <% end %>
    
    <% if @pest.family.present? %>
      <div class="info-item">
        <span class="info-label">üåø <%= t('.family') %>:</span>
        <span class="info-value"><%= @pest.family %></span>
      </div>
    <% end %>
    
    <% if @pest.order.present? %>
      <div class="info-item">
        <span class="info-label">üìã <%= t('.order') %>:</span>
        <span class="info-value"><%= @pest.order %></span>
      </div>
    <% end %>
    
    <% if @pest.description.present? %>
      <div class="info-item">
        <span class="info-label">üìÑ <%= t('.description') %>:</span>
        <span class="info-value"><%= simple_format(@pest.description) %></span>
      </div>
    <% end %>
    
    <% if @pest.occurrence_season.present? %>
      <div class="info-item">
        <span class="info-label">üìÖ <%= t('.occurrence_season') %>:</span>
        <span class="info-value"><%= @pest.occurrence_season %></span>
      </div>
    <% end %>
    
    <% if @pest.pest_temperature_profile %>
      <div class="info-item">
        <span class="info-label">üå°Ô∏è <%= t('.temperature_profile') %>:</span>
        <div class="info-value">
          <%= t('.base_temperature') %>: <%= @pest.pest_temperature_profile.base_temperature %>¬∞C<br>
          <%= t('.max_temperature') %>: <%= @pest.pest_temperature_profile.max_temperature %>¬∞C
        </div>
      </div>
    <% end %>
    
    <% if @pest.pest_thermal_requirement %>
      <div class="info-item">
        <span class="info-label">üå°Ô∏è <%= t('.thermal_requirement') %>:</span>
        <div class="info-value">
          <%= t('.required_gdd') %>: <%= @pest.pest_thermal_requirement.required_gdd %>¬∞C„ÉªÊó•<br>
          <% if @pest.pest_thermal_requirement.first_generation_gdd.present? %>
            <%= t('.first_generation_gdd') %>: <%= @pest.pest_thermal_requirement.first_generation_gdd %>¬∞C„ÉªÊó•
          <% else %>
            <%= t('.first_generation_gdd') %>: <%= t('.not_available') %>
          <% end %>
        </div>
      </div>
    <% end %>
    
    <div class="info-item">
      <span class="info-label">üìÖ <%= t('.created_at') %>:</span>
      <span class="info-value"><%= I18n.l(@pest.created_at, format: :long) %></span>
    </div>
    
    <div class="info-item">
      <span class="info-label">üìÖ <%= t('.updated_at') %>:</span>
      <span class="info-value"><%= I18n.l(@pest.updated_at, format: :long) %></span>
    </div>
  </div>
  
  <% if @pest.pest_control_methods.any? %>
    <div class="stages-section">
      <h2 class="stages-title"><%= t('.control_methods_title') %></h2>
      <div class="control-methods-list">
        <% @pest.pest_control_methods.order(:id).each do |method| %>
          <div class="control-method-card">
            <div class="method-header">
              <span class="method-type-badge method-type-<%= method.method_type %>">
                <%= t(".method_type.#{method.method_type}") %>
              </span>
              <h4 class="method-name"><%= method.method_name %></h4>
            </div>
            <% if method.description.present? %>
              <div class="method-description"><%= simple_format(method.description) %></div>
            <% end %>
            <% if method.timing_hint.present? %>
              <div class="method-timing">
                <span class="timing-label"><%= t('.timing_hint') %>:</span>
                <span class="timing-value"><%= method.timing_hint %></span>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
  
  <% if @crops&.any? %>
    <div class="stages-section">
      <h2 class="stages-title"><%= t('.crops_title') %></h2>
      <div class="related-crops-grid">
        <% @crops.each do |crop| %>
          <article class="related-crop-card">
            <div class="related-crop-card__header">
              <h3 class="related-crop-card__name">
                <%= link_to crop.name, crop_path(crop), class: "related-crop-card__link" %>
              </h3>
              <% if crop.is_reference %>
                <span class="related-crop-card__badge"><%= t('.reference_crop') %></span>
              <% end %>
            </div>
            <% if crop.variety.present? %>
              <p class="related-crop-card__variety"><%= crop.variety %></p>
            <% end %>
          </article>
        <% end %>
      </div>
    </div>
  <% else %>
    <div class="stages-section">
      <h2 class="stages-title"><%= t('.crops_title') %></h2>
      <div class="no-crops">
        <p><%= t('.no_crops_description') %></p>
      </div>
    </div>
  <% end %>

    <div class="actions">
      <%= link_to t('.back_to_list'), pests_path, class: "btn btn-secondary" %>
      <% if @pest.is_reference %>
        <%# ÂèÇÁÖßÂÆ≥Ëô´„ÅØÁÆ°ÁêÜËÄÖ„ÅÆ„ÅøÁ∑®ÈõÜ„ÉªÂâäÈô§ÂèØËÉΩ %>
        <% if admin_user? %>
          <%= link_to t('.edit'), edit_pest_path(@pest), class: "btn btn-secondary" %>
          <%= link_to t('.delete'), pest_path(@pest),
                      class: "btn btn-error",
                      data: {
                        controller: "undo-delete",
                        action: "click->undo-delete#submit",
                        turbo_method: :delete,
                        undo_delete_url_value: pest_path(@pest),
                        undo_delete_message_value: t('pests.undo.toast', name: @pest.name),
                        undo_delete_redirect_url_value: pests_path
                      } %>
        <% end %>
      <% else %>
        <%# „É¶„Éº„Ç∂„ÉºÂÆ≥Ëô´„ÅØÊâÄÊúâËÄÖ„ÅåÁ∑®ÈõÜ„ÉªÂâäÈô§ÂèØËÉΩ %>
        <%= link_to t('.edit'), edit_pest_path(@pest), class: "btn btn-secondary" %>
        <%= link_to t('.delete'), pest_path(@pest),
                    class: "btn btn-error",
                    data: {
                      controller: "undo-delete",
                      action: "click->undo-delete#submit",
                      turbo_method: :delete,
                      undo_delete_url_value: pest_path(@pest),
                      undo_delete_message_value: t('pests.undo.toast', name: @pest.name),
                      undo_delete_redirect_url_value: pests_path
                    } %>
      <% end %>
    </div>
</div>

