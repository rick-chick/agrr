<%# encoding: UTF-8 %>
<%# app/views/public_plans/results.html.erb %>
<%# 作付け計画完成画面 - ガントチャート形式 %>

<div class="public-plans-wrapper">
  <div class="cultivation-results-container">
    
    <%# ヘッダー・サマリー %>
    <%= render 'public_plans/results/header', cultivation_plan: @cultivation_plan %>
    
    <%# ガントチャート（作物パレットを含む） - 共通パーシャルを使用 %>
    <div data-controller="plans-show">
    <%= render 'shared/gantt_chart', 
               cultivation_plan: @cultivation_plan,
               show_crop_palette: true,
               plan_type: 'public',
               data_url: data_api_v1_public_plans_cultivation_plan_path(@cultivation_plan),
               adjust_url: adjust_api_v1_public_plans_cultivation_plan_path(@cultivation_plan),
               add_field_url: add_field_api_v1_public_plans_cultivation_plan_path(@cultivation_plan),
               remove_field_url: remove_field_api_v1_public_plans_cultivation_plan_path(id: @cultivation_plan.id, field_id: 'PLACEHOLDER'),
               add_crop_url: add_crop_api_v1_public_plans_cultivation_plan_path(@cultivation_plan),
               optimization_channel: 'OptimizationChannel',
               gantt_title: t('public_plans.results.gantt.title'),
               detail_title: t('public_plans.show.detail.title'),
               detail_loading: t('public_plans.show.detail.loading'),
               crop_palette_toggle_label: t('public_plans.results.crop_palette.toggle', default: '作物を追加'),
               crop_palette_title: t('public_plans.results.crop_palette.title', default: '作物を追加'),
               crop_palette_in_use_label: t('public_plans.results.crop_palette.in_use', default: '使用中') %>
    </div>
    
    <%# 気温・GDDチャート表示エリア（作物クリック時に表示、climate_chart.jsが内容を生成） %>
    <div id="climate-chart-display" 
         class="hidden" 
         data-chart-title="<%= t('public_plans.results.chart_title') %>"
         data-loading-message="<%= t('public_plans.results.loading_data') %>"
         data-temperature-section="<%= t('public_plans.results.chart.temperature_section') %>"
         data-gdd-section="<%= t('public_plans.results.chart.gdd_section') %>"
         data-temp-max="<%= t('public_plans.results.chart.temp_max') %>"
         data-temp-mean="<%= t('public_plans.results.chart.temp_mean') %>"
         data-temp-min="<%= t('public_plans.results.chart.temp_min') %>"
         data-temp-chart-title="<%= t('public_plans.results.chart.temp_chart_title') %>"
         data-optimal-zone="<%= t('public_plans.results.chart.optimal_zone') %>"
         data-stress-zone="<%= t('public_plans.results.chart.stress_zone') %>"
         data-stage-optimal-label="<%= t('public_plans.results.chart.stage_optimal_label') %>"
         data-daily-gdd="<%= t('public_plans.results.chart.daily_gdd') %>"
         data-cumulative-gdd="<%= t('public_plans.results.chart.cumulative_gdd') %>"
         data-required-gdd="<%= t('public_plans.results.chart.required_gdd') %>"
         data-gdd-chart-title="<%= t('public_plans.results.chart.gdd_chart_title') %>"
         data-date-label="<%= t('public_plans.results.chart.date_label') %>"
         data-cumulative-required-label="<%= t('public_plans.results.chart.cumulative_required_label') %>"
         data-temp-chart-axis-label="<%= t('public_plans.results.chart.temp_axis_label') %>"
         data-fetch-error="<%= t('js.climate_chart.fetch_failed') %>"
         data-load-error="<%= t('js.climate_chart.load_failed') %>"
         data-chart-create-error="<%= t('js.climate_chart.chart_create_failed') %>"
         data-gdd-chart-create-error="<%= t('js.climate_chart.gdd_chart_create_failed') %>"></div>
    
    <%# アクションボタン %>
    <div class="action-buttons">
      <%= form_with url: save_plan_public_plans_path, method: :post, local: true, id: "save-plan-form" do |f| %>
        <%= f.submit t('public_plans.save.button'), class: "btn-primary", id: "save-plan-button" %>
      <% end %>
      <% if logged_in? %>
        <%= link_to plans_path, class: "btn-white" do %>
          <%= t('public_plans.results.view_my_plans') %>
        <% end %>
      <% end %>
      <%= link_to public_plans_path, class: "btn-white" do %>
        <%= t('.create_new_plan') %>
      <% end %>
    </div>
    
  </div>
</div>

<%# Chart.js は npm で管理され application.js にバンドル済み %>

<%# レガシーJSの個別読み込みは廃止（application.js にバンドル済み） %>
