<%# app/views/public_plans/results/_gantt_row.html.erb %>
<%# ガントチャートの1行（1圃場・1作物） %>

<tr class="gantt-row" 
    data-field-cultivation-id="<%= field_cultivation.id %>"
    data-crop-name="<%= field_cultivation.crop_display_name %>"
    data-field-name="<%= field_cultivation.field_display_name %>">
  
  <%# 左側の固定列（圃場名・作物名） %>
  <td class="gantt-sticky-col gantt-field-info">
    <div class="field-info-content">
      <div class="field-name"><%= field_cultivation.field_display_name %></div>
      <div class="crop-name"><%= field_cultivation.crop_display_name %></div>
    </div>
  </td>
  
  <%# 月数分のセル %>
  <% if field_cultivation.start_date && field_cultivation.completion_date %>
    <% 
      start_month = calculate_month_index(field_cultivation.start_date, plan_start_date)
      end_month = calculate_month_index(field_cultivation.completion_date, plan_start_date)
      duration_months = end_month - start_month + 1
    %>
    
    <%# 栽培開始前の空セル %>
    <% (1...start_month).each do %>
      <td class="gantt-empty-cell"></td>
    <% end %>
    
    <%# 栽培期間のセル（結合） %>
    <td colspan="<%= duration_months %>" 
        class="gantt-cultivation-bar <%= crop_class(field_cultivation.crop_display_name) %>">
      <div class="bar-content">
        <span class="bar-period">
          <%= field_cultivation.start_date.strftime('%-m/%-d') %> 〜 <%= field_cultivation.completion_date.strftime('%-m/%-d') %>
        </span>
      </div>
    </td>
    
    <%# 栽培終了後の空セル %>
    <% ((end_month + 1)..total_months).each do %>
      <td class="gantt-empty-cell"></td>
    <% end %>
  <% else %>
    <%# データがない場合 %>
    <% (1..total_months).each do %>
      <td class="gantt-empty-cell gantt-no-data"></td>
    <% end %>
  <% end %>
</tr>

