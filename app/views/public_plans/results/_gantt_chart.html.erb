<%# app/views/public_plans/results/_gantt_chart.html.erb %>
<%# ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆå…¨ä½“ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ï¼‰ %>

<%
  # æ ½åŸ¹ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æœŸé–“ã®è¨ˆç®—
  plan_start_date = Date.current.beginning_of_month  # ä»Šæœˆã®1æ—¥
  plan_end_date = Date.new(Date.current.year + 1, 12, 31)  # æ¥å¹´ã®12/31
  
  # è¡¨ç¤ºã™ã‚‹å¹´ã¨æœˆã®é…åˆ—ã‚’ç”Ÿæˆ
  start_year = plan_start_date.year
  start_month = plan_start_date.month
  end_year = plan_end_date.year
  end_month = plan_end_date.month
  
  # å„å¹´ã®æœˆæ•°ã‚’è¨ˆç®—
  years_months = {}
  (start_year..end_year).each do |year|
    first_month = (year == start_year) ? start_month : 1
    last_month = (year == end_year) ? end_month : 12
    years_months[year] = (first_month..last_month).to_a
  end
  
  total_months = years_months.values.flatten.count
%>

<div class="gantt-section">
  <h2 class="gantt-title">
    <span class="gantt-title-icon">ğŸ“Š</span>
    <span class="gantt-title-text">æ ½åŸ¹ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</span>
  </h2>
  
  <div class="gantt-scroll-hint">
    <span class="scroll-hint-icon">ğŸ‘†</span>
    <span class="scroll-hint-text">æ¨ªã«ã‚¹ãƒ¯ã‚¤ãƒ—ãƒ»ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§ãã¾ã™</span>
  </div>
  
  <div class="gantt-container">
    <table class="gantt-table">
      <thead>
        <tr class="gantt-header-year">
          <th class="gantt-sticky-col" rowspan="2">åœƒå ´ / ä½œç‰©</th>
          <% years_months.each do |year, months| %>
            <th colspan="<%= months.count %>" class="gantt-year-header year-<%= year %>"><%= year %>å¹´</th>
          <% end %>
        </tr>
        <tr class="gantt-header-month">
          <% years_months.each do |year, months| %>
            <% months.each do |month| %>
              <th class="gantt-month-header"><%= month %>æœˆ</th>
            <% end %>
          <% end %>
        </tr>
      </thead>
      <tbody>
        <%# å„åœƒå ´ãƒ»ä½œç‰©ã®è¡Œ %>
        <% cultivation_plan.field_cultivations.each do |field_cultivation| %>
          <%= render 'public_plans/results/gantt_row', 
                     field_cultivation: field_cultivation,
                     plan_start_date: plan_start_date,
                     plan_end_date: plan_end_date,
                     total_months: total_months %>
        <% end %>
      </tbody>
    </table>
  </div>
</div>

