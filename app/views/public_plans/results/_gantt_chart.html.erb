<%# app/views/public_plans/results/_gantt_chart.html.erb %>
<%# Frappe Gantt ã‚’ä½¿ç”¨ã—ãŸã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆ %>

<%
  # æ ½åŸ¹ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æœŸé–“ã®è¨ˆç®—
  plan_start_date = cultivation_plan.planning_start_date || Date.current
  plan_end_date = cultivation_plan.planning_end_date
  
  # Frappe Ganttç”¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™
  cultivation_data = cultivation_plan.field_cultivations.map do |fc|
    {
      id: fc.id,
      field_id: fc.cultivation_plan_field_id,
      field_name: fc.field_display_name,
      crop_name: fc.crop_display_name,
      start_date: fc.start_date.to_s,
      completion_date: fc.completion_date.to_s,
      cultivation_days: fc.cultivation_days,
      area: fc.area,
      estimated_cost: fc.estimated_cost,
      profit: fc.optimization_result&.dig('profit')
    }
  end
  
  # åœƒå ´æƒ…å ±ã‚’æº–å‚™
  fields_data = cultivation_plan.cultivation_plan_fields.map do |field|
    {
      id: field.id,
      field_id: field.id,
      name: field.name,
      area: field.area
    }
  end
%>

<div class="gantt-section">
  <div class="gantt-header">
    <h2 class="gantt-title">
      <span class="gantt-title-icon">ğŸ“Š</span>
      <span class="gantt-title-text"><%= t('public_plans.results.gantt.title') %></span>
    </h2>
    
    <%# ä½œç‰©ãƒ‘ãƒ¬ãƒƒãƒˆï¼ˆãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ï¼‰ - ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆã®å³ä¸Šã«é…ç½® %>
    <%= render 'public_plans/results/crop_palette', cultivation_plan: cultivation_plan %>
  </div>
  
  <%# Frappe Gantt ã‚³ãƒ³ãƒ†ãƒŠ %>
  <div id="gantt-chart-container"
       data-cultivations="<%= cultivation_data.to_json %>"
       data-fields="<%= fields_data.to_json %>"
       data-plan-start-date="<%= plan_start_date.to_s %>"
       data-plan-end-date="<%= plan_end_date.to_s %>"
       data-cultivation-plan-id="<%= cultivation_plan.id %>">
  </div>
  
  <!-- Google AdSense åºƒå‘Š -->
  <%= render 'shared/adsense_display_ad', ad_slot: '0000000000', ad_format: 'horizontal' %>
</div>

