<%# ä½œç‰©ãƒ‘ãƒ¬ãƒƒãƒˆï¼ˆã‚µã‚¤ãƒ‰ãƒ‘ãƒãƒ«ï¼‰ %>
<%# é¸æŠžå¯èƒ½ãªä½œç‰©ã‚’ã‚«ãƒ¼ãƒ‰ã§è¡¨ç¤ºã—ã€ãƒ‰ãƒ©ãƒƒã‚°ã§ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã«è¿½åŠ ã§ãã‚‹ %>

<%
  # ç¾åœ¨ã®è¨ˆç”»ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ä½œç‰©
  used_crop_ids = cultivation_plan.cultivation_plan_crops.map(&:agrr_crop_id).compact
  
  # åŒã˜åœ°åŸŸã®å‚ç…§ä½œç‰©ã‚’å–å¾—
  available_crops = Crop.reference.where(region: cultivation_plan.farm.region).order(:name)
%>

<%# ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚³ãƒ³ãƒ†ãƒŠï¼ˆæ ½åŸ¹ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å³ä¸Šã«é…ç½®ï¼‰ %>
<div class="crop-palette-container">
  <%# ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ‘ãƒãƒ« %>
  <div class="crop-palette-panel" id="crop-palette-panel">
    <%# çµ±åˆã•ã‚ŒãŸãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆãƒœã‚¿ãƒ³ã¨ãƒ‘ãƒãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’çµ±åˆï¼‰ %>
    <div class="crop-palette-header" id="crop-palette-toggle" role="button" tabindex="0" aria-label="<%= t('public_plans.results.crop_palette.toggle') %>">
      <div class="crop-palette-title">
        <span class="crop-palette-icon">ðŸŒ±</span>
        <span class="toggle-text"><%= t('public_plans.results.crop_palette.title') %></span>
      </div>
      <span class="toggle-icon">â–¼</span>
    </div>
  
  <div class="crop-palette-body">
    <p class="crop-palette-hint">
      <%= t('public_plans.results.crop_palette.hint') %>
    </p>
    
    <div class="crop-palette-grid">
      <% available_crops.each do |crop| %>
        <div class="crop-palette-card" 
             data-crop-id="<%= crop.id %>"
             data-crop-name="<%= crop.name %>"
             data-crop-variety="<%= crop.variety %>"
             data-agrr-crop-id="<%= crop.agrr_crop_id || crop.name %>">
          <!-- ã‚¬ãƒ³ãƒˆã‚«ãƒ¼ãƒ‰ã¨åŒã˜ã‚¹ã‚¿ã‚¤ãƒ«ã®ãƒãƒ¼ -->
          <div class="crop-card-bar">
            <span class="crop-card-label"><%= crop.name %></span>
            <% if used_crop_ids.include?(crop.id) || used_crop_ids.include?(crop.agrr_crop_id) %>
              <span class="crop-card-badge"><%= t('public_plans.results.crop_palette.in_use') %></span>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
  </div>
</div>
