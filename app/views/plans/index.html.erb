<% content_for :title, t('plans.index.title') %>

<div class="plans-wrapper">
  <div class="plans-container">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="plans-header">
      <div class="plans-header-main">
        <div>
          <h1 class="plans-header-title">
            <%= t('plans.index.title') %>
          </h1>
          <p class="plans-header-subtitle">
            <%= t('plans.index.subtitle') %>
          </p>
        </div>
        <div>
          <%= link_to new_plan_path, class: "btn-plans-primary" do %>
            <%= t('plans.index.create_new') %>
          <% end %>
        </div>
      </div>
    </div>

    <% if @plans_by_year.empty? %>
      <!-- è¨ˆç”»ãŒãªã„å ´åˆ -->
      <div class="plans-empty">
        <div class="plans-empty-icon">ðŸ“…</div>
        <h2 class="plans-empty-title">
          <%= t('plans.index.no_plans') %>
        </h2>
        <p class="plans-empty-subtitle">
          <%= t('plans.index.no_plans_hint') %>
        </p>
        <%= link_to new_plan_path, class: "btn-plans-primary" do %>
          <%= t('plans.index.create_new') %>
        <% end %>
      </div>
    <% else %>
      <!-- å¹´åº¦åˆ¥ã®è¨ˆç”»ä¸€è¦§ -->
      <% @available_years.reverse.each do |year| %>
        <% year_plans = @plans_by_year[year] %>
        
        <div class="plans-year-section">
          <h2 class="plans-year-title">
            <%= t('plans.index.year_label', year: year) %>
          </h2>
          
          <% if year_plans.present? %>
            <div class="plans-grid">
              <% year_plans.each do |plan| %>
                <div class="plan-card">
                  <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ -->
                  <div class="plan-card-header">
                    <span class="plan-card-status <%= plan.status %>">
                      <%= t("plans.index.status.#{plan.status}") %>
                    </span>
                  </div>
                  
                  <!-- è¨ˆç”»å -->
                  <h3 class="plan-card-title">
                    <%= plan.display_name %>
                  </h3>
                  
                  <!-- è¾²å ´æƒ…å ± -->
                  <div class="plan-card-details">
                    <div class="plan-card-detail-item">
                      <span class="plan-card-detail-label"><%= t('plans.index.plan_card.farm') %>:</span>
                      <span><%= plan.farm.display_name %></span>
                    </div>
                    <div class="plan-card-detail-item">
                      <span class="plan-card-detail-label"><%= t('plans.index.plan_card.total_area') %>:</span>
                      <span><%= number_with_delimiter(plan.total_area) %> ãŽ¡</span>
                    </div>
                    <div class="plan-card-detail-item">
                      <span><%= t('plans.index.plan_card.crops_count', count: plan.cultivation_plan_crops.count) %></span>
                      <span>ãƒ»</span>
                      <span><%= t('plans.index.plan_card.fields_count', count: plan.cultivation_plan_fields.count) %></span>
                    </div>
                  </div>
                  
                  <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
                  <div class="plan-card-actions">
                    <% if plan.status_completed? %>
                      <%= link_to t('plans.index.plan_card.view'), plan_path(plan), 
                          class: "plan-card-action-btn primary" %>
                      <%= button_to t('plans.index.plan_card.copy'), copy_plan_path(plan), method: :post,
                          data: { confirm: t('plans.messages.plan_copied', year: year + 1) },
                          class: "plan-card-action-btn secondary" %>
                    <% elsif plan.status_optimizing? %>
                      <%= link_to t('plans.index.plan_card.view'), optimizing_plan_path(plan), 
                          class: "plan-card-action-btn primary" %>
                    <% end %>
                  </div>
                  
                  <!-- ä½œæˆæ—¥ -->
                  <div class="plan-card-meta">
                    <%= t('plans.index.plan_card.created_at') %>: <%= l(plan.created_at, format: :short) %>
                  </div>
                </div>
              <% end %>
            </div>
          <% else %>
            <!-- ãã®å¹´åº¦ã«è¨ˆç”»ãŒãªã„å ´åˆ -->
            <div class="content-card">
              <p style="text-align: center; color: var(--text-secondary);">
                <%= t('plans.index.no_plans') %>
              </p>
            </div>
          <% end %>
        </div>
      <% end %>
    <% end %>
  </div>
</div>
