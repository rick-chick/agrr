<% content_for :title, t('plans.optimizing.title') %>

<div class="plans-wrapper pb-0" 
     data-optimizing-container
     data-cultivation-plan-id="<%= @cultivation_plan.id %>"
     data-channel-name="PlansOptimizationChannel"
     data-redirect-url="<%= plan_path(@cultivation_plan) %>"
     data-error-message="<%= t('plans.optimizing.error_message') %>">
  <div class="plans-container">
    <!-- Compact Header -->
    <div class="compact-header-card">
      <div class="compact-header-title">
        <span class="title-icon">ğŸŒ±</span>
        <span class="title-text"><%= t('plans.optimizing.title') %></span>
        <span class="status-badge optimizing"><%= t('plans.optimizing.status_badge') %></span>
      </div>
      <div class="compact-subtitle">
        <%= t('plans.optimizing.year_label', year: @cultivation_plan.plan_year) %> Â· 
        <%= @cultivation_plan.farm.display_name %> Â· 
        <%= t('plans.optimizing.crops_count', count: @cultivation_plan.cultivation_plan_crops.count) %>
      </div>
    </div>
    
    <!-- Spacer for fixed progress bar -->
    <div class="spacer-for-fixed-bar"></div>
  </div>
</div>

<!-- Fixed Bottom Progress Bar -->
<div class="fixed-progress-bar">
  <div class="fixed-progress-container">
    <div class="progress-header">
      <div class="progress-label-with-spinner">
        <span class="spinner spinner-sm" id="loading-spinner"></span>
        <div class="progress-info">
          <div class="progress-phase-message" id="phase-message">
            <%= @cultivation_plan.optimization_phase_message || t('plans.optimizing.progress.default_message') %>
          </div>
          <div class="progress-duration-hint" id="progress-duration-hint"><%= t('plans.optimizing.progress.duration_hint') %></div>
        </div>
      </div>
      <div class="progress-elapsed-time" 
           id="elapsed-time"
           data-elapsed-time-template="<%= t('plans.optimizing.progress.elapsed_time', time: '%{time}') %>"
           data-elapsed-time-minute-template="<%= t('plans.optimizing.progress.elapsed_time_minute', minutes: '%{minutes}', seconds: '%{seconds}') %>">
        <%= t('plans.optimizing.progress.elapsed_time', time: '0') %>
      </div>
    </div>
    
    <!-- ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã‚¨ãƒªã‚¢ï¼ˆåˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤ºï¼‰ -->
    <div class="error-message-container" id="error-message-container" style="display: none;">
      <div class="error-icon">âš ï¸</div>
      <div class="error-content">
        <div class="error-title"><%= t('plans.optimizing.error.title') %></div>
        <div class="error-detail" id="error-detail"></div>
        <div class="error-actions">
          <a href="<%= select_crop_plans_path %>" class="btn btn-primary">
            <%= t('plans.optimizing.error.try_again') %>
          </a>
          <a href="<%= plans_path %>" class="btn btn-secondary">
            <%= t('plans.optimizing.error.start_over') %>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- JavaScript is loaded from app/assets/javascripts/optimizing.js (å…±é€š) -->
<% content_for :javascripts do %>
  <%= javascript_include_tag "actioncable", defer: true %>
  <%= javascript_include_tag "optimizing", defer: true %>
<% end %>
