<% content_for :title, t('plans.select_crop.title') %>

<div class="plans-wrapper" data-controller="crop-select">
  <div class="plans-container">
    <!-- „Éò„ÉÉ„ÉÄ„Éº -->
    <div class="compact-header-card">
      <div class="compact-header-title">
        <span class="title-icon">üå±</span>
        <span class="title-text"><%= t('plans.title') %></span>
      </div>
    </div>
    
    <!-- „Çµ„Éû„É™„Éº„Ç´„Éº„Éâ -->
    <div class="enhanced-summary-card">
      <div class="enhanced-summary-items">
        <div class="enhanced-summary-row">
          <div class="enhanced-summary-icon">üåç</div>
          <div class="enhanced-summary-content">
            <div class="enhanced-summary-label"><%= t('plans.select_crop.summary.farm') %></div>
            <div class="enhanced-summary-value"><%= @vm.farm.display_name %></div>
          </div>
        </div>
        <div class="enhanced-summary-row">
          <div class="enhanced-summary-icon">üìê</div>
          <div class="enhanced-summary-content">
            <div class="enhanced-summary-label"><%= t('plans.select_crop.summary.total_area') %></div>
            <div class="enhanced-summary-value"><%= number_with_delimiter(@vm.total_area) %> „é°</div>
          </div>
        </div>
      </div>
    </div>

    <!-- „Ç≥„É≥„ÉÜ„É≥„ÉÑ„Ç´„Éº„Éâ -->
    <div class="content-card">
      <h2 class="content-card-title"><%= t('plans.select_crop.title') %></h2>
      <p class="content-card-subtitle"><%= t('plans.select_crop.subtitle') %></p>
      
      <%= form_with url: plans_path, method: :post, id: "cropForm", data: { turbo: true } do |f| %>
        <% if @vm.crops.empty? %>
          <!-- ‰ΩúÁâ©„Åå„Å™„ÅÑÂ†¥Âêà -->
          <div class="plans-empty">
            <div class="plans-empty-icon">üåæ</div>
            <h3 class="plans-empty-title">
              <%= t('plans.select_crop.no_crops') %>
            </h3>
            <p class="plans-empty-subtitle">
              <%= t('plans.select_crop.no_crops_hint') %>
            </p>
            <%= link_to t('plans.select_crop.create_crop_link'), new_crop_path, 
                class: "btn btn-primary" %>
          </div>
        <% else %>
          <!-- ‰ΩúÁâ©ÈÅ∏Êäû„Ç∞„É™„ÉÉ„Éâ -->
          <div class="enhanced-grid">
            <% @vm.crops.each do |crop| %>
              <div class="crop-item">
                <input type="checkbox" 
                       name="crop_ids[]" 
                       value="<%= crop.id %>" 
                       id="crop_<%= crop.id %>" 
                       class="crop-check"
                       data-action="change->crop-select#updateState">
                <label for="crop_<%= crop.id %>" class="crop-card">
                  <div class="crop-emoji">ü•¨</div>
                  <div class="crop-name"><%= crop.name %></div>
                  <% if crop.variety.present? %>
                    <div class="crop-variety"><%= crop.variety %></div>
                  <% end %>
                  <div class="check-mark">‚úì</div>
                </label>
              </div>
            <% end %>
          </div>
          
          <!-- „Çπ„Éö„Éº„Çµ„ÉºÔºàÂõ∫ÂÆö„Éê„ÉºÂàÜÔºâ -->
          <div class="spacer-height-120"></div>
        <% end %>
      <% end %>
    </div>
  </div>

  <!-- Fixed Bottom Bar -->
  <% if @vm.crops.any? %>
    <div class="fixed-bottom-bar">
      <div class="fixed-bottom-bar-content">
        <div class="fixed-bottom-bar-left">
          <%= link_to t('plans.select_crop.bottom_bar.back_button'), new_plan_path, 
              class: "btn btn-ghost" %>
          
          <div class="selection-counter-group">
            <span><%= t('plans.select_crop.bottom_bar.selected_label') %>:</span>
            <span id="counter" class="counter-badge" data-crop-select-target="counter">0</span>
            <span><%= t('plans.select_crop.bottom_bar.selected_unit') %></span>
          </div>
        </div>
        
        <button type="submit" form="cropForm" id="submitBtn" 
                disabled
                data-crop-select-target="submit"
                class="btn btn-primary">
          <%= t('plans.select_crop.bottom_bar.submit_button') %>
        </button>
      </div>
      
      <div id="hint" class="hint-message" data-crop-select-target="hint">
        <%= t('plans.select_crop.bottom_bar.hint') %>
      </div>
    </div>
  <% end %>
</div>

<!-- Stimulus controller handles interactions; legacy JS include removed -->
