<% content_for :title, t('plans.new.title') %>

<div class="plans-wrapper">
  <div class="plans-container">
    <!-- „Éò„ÉÉ„ÉÄ„Éº -->
    <div class="compact-header-card">
      <div class="compact-header-title">
        <span class="title-icon">üìÖ</span>
        <span class="title-text"><%= t('plans.title') %></span>
      </div>
    </div>

    <!-- „Ç≥„É≥„ÉÜ„É≥„ÉÑ„Ç´„Éº„Éâ -->
    <div class="content-card">
      <h2 class="content-card-title"><%= t('plans.new.title') %></h2>
      <p class="content-card-subtitle"><%= t('plans.new.subtitle') %></p>

      <%= form_with url: select_crop_plans_path, method: :get, local: true do |f| %>
        <!-- Ë®àÁîªÂπ¥Â∫¶ÈÅ∏Êäû -->
        <div class="plans-form-group">
          <label class="plans-form-label">
            <%= t('plans.new.plan_year_label') %>
          </label>
          <p class="plans-form-hint">
            <%= t('plans.new.plan_year_hint', start_year: @vm.current_year - 1, end_year: @vm.current_year + 1) %>
          </p>
          <select name="plan_year" required class="plans-form-select">
            <% @vm.available_years.each do |year| %>
              <option value="<%= year %>" <%= 'selected' if year == @vm.current_year %>>
                <%= year %>Âπ¥Â∫¶Ôºà<%= year - 1 %>Âπ¥1Êúà„Äú<%= year + 1 %>Âπ¥12ÊúàÔºâ
              </option>
            <% end %>
          </select>
        </div>


        <!-- Ëæ≤Â†¥ÈÅ∏Êäû -->
        <div class="plans-form-group">
          <label class="plans-form-label">
            <%= t('plans.new.farm_label') %>
          </label>
          <p class="plans-form-hint">
            <%= t('plans.new.farm_hint') %>
          </p>

          <% if @vm.farms.empty? %>
            <!-- Ëæ≤Â†¥„Åå„Å™„ÅÑÂ†¥Âêà -->
            <div class="plans-empty">
              <div class="plans-empty-icon">üåæ</div>
              <p class="plans-empty-subtitle">
                <%= t('plans.new.no_farms') %>
              </p>
              <p class="plans-form-hint">
                <%= t('plans.new.no_farms_hint') %>
              </p>
              <%= link_to t('plans.new.create_farm_link'), new_farm_path, 
                  class: "btn-plans-primary" %>
            </div>
          <% else %>
            <!-- Ëæ≤Â†¥„Ç´„Éº„Éâ„Ç∞„É™„ÉÉ„Éâ -->
            <div class="radio-card-grid">
              <% @vm.farms.each do |farm| %>
                <label class="radio-card-wrapper">
                  <input type="radio" name="farm_id" value="<%= farm.id %>" required
                         class="radio-card-input" />
                  <div class="radio-card">
                    <h3 class="radio-card-title">
                      <%= farm.display_name %>
                    </h3>
                    <div class="radio-card-details">
                      <div>
                        üìç <%= farm.latitude.round(4) %>, <%= farm.longitude.round(4) %>
                      </div>
                      <% if farm.fields.any? %>
                        <div>
                          üåæ <%= farm.fields.count %>ÂúÉÂ†¥ / Á∑èÈù¢Á©ç: <%= number_with_delimiter(farm.fields.sum(:area)) %>„é°
                        </div>
                      <% end %>
                    </div>
                  </div>
                </label>
              <% end %>
            </div>
          <% end %>
        </div>

        <!-- ÈÄÅ‰ø°„Éú„Çø„É≥ -->
        <% if @vm.farms.any? %>
          <div style="text-align: center; margin-top: var(--space-8);">
            <button type="submit" class="btn-plans-primary" style="width: 100%; max-width: 400px;">
              <%= t('plans.new.next_button') %>
            </button>
          </div>
        <% end %>
      <% end %>

      <!-- Êàª„Çã„É™„É≥„ÇØ -->
      <div style="margin-top: var(--space-6); text-align: center;">
        <%= link_to plans_path, style: "color: var(--color-primary); text-decoration: none;" do %>
          ‚Üê <%= t('plans.show.back_to_list') %>
        <% end %>
      </div>
    </div>
  </div>
</div>
