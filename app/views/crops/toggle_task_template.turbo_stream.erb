<%= turbo_stream.replace "available-task-templates" do %>
  <% if @available_agricultural_tasks.any? %>
    <div class="task-manual-section" id="available-task-templates">
      <div class="task-manual-section__header">
        <h3 class="task-manual-section__title"><%= t('crops.show.available_task_templates_title') %></h3>
        <span class="task-manual-section__count">
          <%= t('crops.show.available_task_count', count: @available_agricultural_tasks.size) %>
        </span>
      </div>
      <div class="task-manual-grid">
        <% @available_agricultural_tasks.each do |task| %>
          <% is_selected = @selected_task_ids.include?(task.id) %>
          <%= button_to toggle_task_template_crop_path(@crop, agricultural_task_id: task.id),
                        method: :post,
                        class: "task-manual-card #{'task-manual-card--selected' if is_selected}",
                        form: { data: { turbo: true } } do %>
            <article class="task-manual-card__content">
              <h4 class="task-manual-card__name">
                <span><%= task.name %></span>
                <% if is_selected %>
                  <span class="task-manual-card__selected-badge">âœ“</span>
                <% end %>
              </h4>
              <p class="task-manual-card__note">
                <%= task.description.present? ? truncate(task.description, length: 80) : t('crops.show.manual_task_hint') %>
              </p>
            </article>
          <% end %>
        <% end %>
      </div>
    </div>
  <% end %>
<% end %>

