<%# app/views/crops/_available_task_templates_section.html.erb %>
<%# 作物詳細画面の利用可能な作業テンプレートセクション %>
<%# 
  パラメータ:
    crop: Crop - 表示する作物オブジェクト
    available_agricultural_tasks: Array<AgriculturalTask> - 利用可能な農業タスクの配列
    selected_task_ids: Array<Integer> - 選択されているタスクIDの配列
  
  必要なデータ例:
    crop.id = 1
    available_agricultural_tasks = [
      { id: 1, name: "種まき", description: "種をまく作業" },
      { id: 2, name: "間引き", description: "成長した苗を間引く" },
      { id: 3, name: "収穫", description: "実を収穫する" }
    ]
    selected_task_ids = [1, 3]  # 選択されているタスクID
  
  使用例（外部から独立して使用可能）:
    render 'crops/available_task_templates_section',
           crop: Crop.find(1),
           available_agricultural_tasks: AgriculturalTask.all,
           selected_task_ids: [1, 3]
    render 'crops/available_task_templates_section',
           crop: @my_crop,
           available_agricultural_tasks: @custom_tasks,
           selected_task_ids: @selected_ids
%>

<% available_agricultural_tasks = local_assigns[:available_agricultural_tasks] || [] %>
<% selected_task_ids = local_assigns[:selected_task_ids] || [] %>
<div class="task-manual-section" id="available-task-templates">
  <% if available_agricultural_tasks.any? %>
    <div class="task-manual-section__header">
      <h3 class="task-manual-section__title"><%= t('crops.show.available_task_templates_title') %></h3>
      <span class="task-manual-section__count">
        <%= t('crops.show.available_task_count', count: available_agricultural_tasks.size) %>
      </span>
    </div>
    <div class="task-manual-grid">
      <% available_agricultural_tasks.each do |task| %>
        <% is_selected = selected_task_ids.include?(task.id) %>
        <%= form_with url: toggle_task_template_crop_path(crop, agricultural_task_id: task.id),
                      method: :post,
                      class: "task-manual-card #{'task-manual-card--selected' if is_selected}",
                      data: { turbo: true } do |f| %>
          <%= f.button type: :submit, class: "task-manual-card__button" do %>
            <article class="task-manual-card__content">
              <h4 class="task-manual-card__name">
                <span><%= task.name %></span>
                <% if is_selected %>
                  <span class="task-manual-card__selected-badge">✓</span>
                <% end %>
              </h4>
              <p class="task-manual-card__note">
                <%= task.description.present? ? truncate(task.description, length: 80) : t('crops.show.manual_task_hint') %>
              </p>
            </article>
          <% end %>
        <% end %>
      <% end %>
    </div>
  <% end %>
</div>

