<% content_for :title, "#{t('.title')} - AGRR" %>

<div class="page-header">
  <h1 class="page-title"><%= t('.title') %></h1>
  <%= link_to t('.new_pesticide'), new_pesticide_path, class: "btn btn-success" %>
</div>

<% if @pesticides&.any? %>
  <div class="crops-grid">
    <% @pesticides.each do |pesticide| %>
      <div class="crop-card" id="<%= dom_id(pesticide) %>" data-undo-delete-record>
        <h3 class="crop-name"><%= pesticide.name %></h3>
        <% if pesticide.active_ingredient.present? %>
          <div class="crop-variety"><%= t('.active_ingredient') %>: <%= pesticide.active_ingredient %></div>
        <% end %>
        <% if admin_user? && pesticide.is_reference %>
          <div class="crop-type reference"><%= t('.reference_pesticides') %></div>
        <% end %>
        <div class="crop-actions">
          <%= link_to t('.actions.show'), pesticide_path(pesticide), class: "btn btn-info btn-sm" %>
          <% if pesticide.is_reference %>
            <%# Reference pesticides: admin only %>
            <% if admin_user? %>
              <%= link_to t('.actions.edit'), edit_pesticide_path(pesticide), class: "btn btn-secondary btn-sm" %>
              <%= link_to t('.actions.delete'), pesticide_path(pesticide),
                          class: "btn btn-error btn-sm",
                          data: {
                            controller: "undo-delete",
                            action: "click->undo-delete#submit",
                            turbo_method: :delete,
                            undo_delete_url_value: pesticide_path(pesticide),
                            undo_delete_message_value: t('pesticides.undo.toast', name: pesticide.name)
                          } %>
            <% end %>
          <% else %>
            <%# User pesticides: owner only %>
            <% if pesticide.user_id == current_user.id || admin_user? %>
              <%= link_to t('.actions.edit'), edit_pesticide_path(pesticide), class: "btn btn-secondary btn-sm" %>
              <%= link_to t('.actions.delete'), pesticide_path(pesticide),
                          class: "btn btn-error btn-sm",
                          data: {
                            controller: "undo-delete",
                            action: "click->undo-delete#submit",
                            turbo_method: :delete,
                            undo_delete_url_value: pesticide_path(pesticide),
                            undo_delete_message_value: t('pesticides.undo.toast', name: pesticide.name)
                          } %>
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <div class="empty-state">
    <div class="empty-state-icon"><%= t('.empty.icon') %></div>
    <h3><%= t('.empty.title') %></h3>
    <p><%= t('.empty.description') %></p>
    <%= link_to t('.empty.button'), new_pesticide_path, class: "btn btn-success" %>
  </div>
<% end %>

