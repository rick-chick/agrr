<% content_for :title, "連作ルール一覧 - AGRR" %>

<div class="page-header">
  <h1 class="page-title">連作ルール一覧</h1>
  <%= link_to "新しいルールを追加", new_interaction_rule_path, class: "btn btn-success" %>
</div>

<% if admin_user? && @reference_rules.any? %>
  <div class="rules-section">
    <h2 class="section-header">システム標準ルール</h2>
    <div class="rules-table">
      <table>
        <thead>
          <tr>
            <th>ルール種類</th>
            <th>影響元</th>
            <th>影響先</th>
            <th>影響係数</th>
            <th>方向性</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          <% @reference_rules.each do |rule| %>
            <tr>
              <td><%= rule.rule_type %></td>
              <td><%= rule.source_group %></td>
              <td><%= rule.target_group %></td>
              <td><%= rule.impact_ratio %></td>
              <td><%= rule.is_directional ? '→' : '↔' %></td>
              <td>
                <%= link_to "詳細", interaction_rule_path(rule), class: "btn btn-info btn-sm" %>
                <%= link_to "編集", edit_interaction_rule_path(rule), class: "btn btn-secondary btn-sm" %>
                <%= link_to "削除", interaction_rule_path(rule), 
                            class: "btn btn-error btn-sm", 
                            data: { 
                              turbo_method: :delete,
                              turbo_confirm: "このシステム標準ルールを削除しますか？"
                            } %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
<% end %>

<% if @interaction_rules.any? %>
  <div class="rules-section">
    <% if admin_user? && @reference_rules.any? %>
      <h2 class="section-header">マイルール</h2>
    <% end %>
    <div class="rules-table">
      <table>
        <thead>
          <tr>
            <th>ルール種類</th>
            <th>影響元</th>
            <th>影響先</th>
            <th>影響係数</th>
            <th>方向性</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          <% @interaction_rules.each do |rule| %>
            <% next if rule.is_reference %>
            <tr>
              <td><%= rule.rule_type %></td>
              <td><%= rule.source_group %></td>
              <td><%= rule.target_group %></td>
              <td><%= rule.impact_ratio %></td>
              <td><%= rule.is_directional ? '→' : '↔' %></td>
              <td>
                <%= link_to "詳細", interaction_rule_path(rule), class: "btn btn-info btn-sm" %>
                <%= link_to "編集", edit_interaction_rule_path(rule), class: "btn btn-secondary btn-sm" %>
                <%= link_to "削除", interaction_rule_path(rule), 
                            class: "btn btn-error btn-sm", 
                            data: { 
                              turbo_method: :delete,
                              turbo_confirm: "このルールを削除しますか？"
                            } %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
<% else %>
  <div class="empty-state">
    <div class="empty-state-icon">📋</div>
    <h3>まだルールが登録されていません</h3>
    <p>最初のルールを追加して始めましょう。</p>
    <%= link_to "ルールを追加", new_interaction_rule_path, class: "btn btn-success" %>
  </div>
<% end %>
