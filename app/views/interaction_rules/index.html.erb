<% content_for :title, "#{t('.title')} - AGRR" %>

<div class="page-header">
  <h1 class="page-title"><%= t('.title') %></h1>
  <%= link_to t('.new_rule'), new_interaction_rule_path, class: "btn btn-success" %>
</div>

<% if admin_user? && @reference_rules.any? %>
  <div class="rules-section">
    <h2 class="section-header"><%= t('.system_rules') %></h2>
    <div class="rules-table">
      <table>
        <thead>
          <tr>
            <th><%= t('.table.rule_type') %></th>
            <th><%= t('.table.source') %></th>
            <th><%= t('.table.target') %></th>
            <th><%= t('.table.impact') %></th>
            <th><%= t('.table.direction') %></th>
            <th><%= t('.table.actions') %></th>
          </tr>
        </thead>
        <tbody>
            <% @reference_rules.each do |rule| %>
              <tr id="<%= dom_id(rule) %>" data-undo-delete-record>
                <td><%= rule.rule_type %></td>
                <td><%= rule.source_group %></td>
                <td><%= rule.target_group %></td>
                <td><%= rule.impact_ratio %></td>
                <td><%= rule.is_directional ? t('.table.directional') : t('.table.bidirectional') %></td>
                <td>
                  <%= link_to t('.actions.detail'), interaction_rule_path(rule), class: "btn btn-info btn-sm" %>
                  <%= link_to t('.actions.edit'), edit_interaction_rule_path(rule), class: "btn btn-secondary btn-sm" %>
                  <%= link_to t('.actions.delete'), interaction_rule_path(rule),
                              class: "btn btn-error btn-sm",
                              data: {
                                controller: "undo-delete",
                                action: "click->undo-delete#submit",
                                turbo_method: :delete,
                                undo_delete_url_value: interaction_rule_path(rule),
                                undo_delete_message_value: t('interaction_rules.undo.toast', source: rule.source_group, target: rule.target_group)
                              } %>
                </td>
              </tr>
            <% end %>
        </tbody>
      </table>
    </div>
  </div>
<% end %>

<% if @interaction_rules.any? %>
  <div class="rules-section">
    <% if admin_user? && @reference_rules.any? %>
      <h2 class="section-header"><%= t('.my_rules') %></h2>
    <% end %>
    <div class="rules-table">
      <table>
        <thead>
          <tr>
            <th><%= t('.table.rule_type') %></th>
            <th><%= t('.table.source') %></th>
            <th><%= t('.table.target') %></th>
            <th><%= t('.table.impact') %></th>
            <th><%= t('.table.direction') %></th>
            <th><%= t('.table.actions') %></th>
          </tr>
        </thead>
        <tbody>
            <% @interaction_rules.each do |rule| %>
              <% next if rule.is_reference %>
              <tr id="<%= dom_id(rule) %>" data-undo-delete-record>
                <td><%= rule.rule_type %></td>
                <td><%= rule.source_group %></td>
                <td><%= rule.target_group %></td>
                <td><%= rule.impact_ratio %></td>
                <td><%= rule.is_directional ? t('.table.directional') : t('.table.bidirectional') %></td>
                <td>
                  <%= link_to t('.actions.detail'), interaction_rule_path(rule), class: "btn btn-info btn-sm" %>
                  <%= link_to t('.actions.edit'), edit_interaction_rule_path(rule), class: "btn btn-secondary btn-sm" %>
                  <%= link_to t('.actions.delete'), interaction_rule_path(rule),
                              class: "btn btn-error btn-sm",
                              data: {
                                controller: "undo-delete",
                                action: "click->undo-delete#submit",
                                turbo_method: :delete,
                                undo_delete_url_value: interaction_rule_path(rule),
                                undo_delete_message_value: t('interaction_rules.undo.toast', source: rule.source_group, target: rule.target_group)
                              } %>
                </td>
              </tr>
            <% end %>
        </tbody>
      </table>
    </div>
  </div>
<% else %>
  <div class="empty-state">
    <div class="empty-state-icon"><%= t('.empty.icon') %></div>
    <h3><%= t('.empty.title') %></h3>
    <p><%= t('.empty.description') %></p>
    <%= link_to t('.empty.button'), new_interaction_rule_path, class: "btn btn-success" %>
  </div>
<% end %>
