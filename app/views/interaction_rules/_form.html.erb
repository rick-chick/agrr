<%= form_with(model: interaction_rule, local: true) do |form| %>
  <% if interaction_rule.errors.any? %>
    <div class="alert alert-danger">
      <h3><%= pluralize(interaction_rule.errors.count, "error") %> prohibited this rule from being saved:</h3>
      <ul>
        <% interaction_rule.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="form-group">
    <%= form.label :rule_type, "ルール種類", class: "form-label" %>
    <%= form.select :rule_type, [
      ['連作', 'continuous_cultivation'],
      ['有益な輪作', 'beneficial_rotation'],
      ['コンパニオンプランツ', 'companion_planting'],
      ['アレロパシー', 'allelopathy'],
      ['土壌適合性', 'soil_compatibility'],
      ['気候適合性', 'climate_compatibility']
    ], { include_blank: '選択してください' }, { class: "form-control" } %>
  </div>

  <div class="form-group">
    <%= form.label :source_group, "影響元グループ", class: "form-label" %>
    <%= form.text_field :source_group, class: "form-control", placeholder: "例: Solanaceae" %>
    <small class="form-text text-muted">作物科名や圃場IDなど</small>
  </div>

  <div class="form-group">
    <%= form.label :target_group, "影響先グループ", class: "form-label" %>
    <%= form.text_field :target_group, class: "form-control", placeholder: "例: Solanaceae" %>
    <small class="form-text text-muted">作物科名や圃場IDなど</small>
  </div>

  <div class="form-group">
    <%= form.label :impact_ratio, "影響係数", class: "form-label" %>
    <%= form.number_field :impact_ratio, step: 0.01, min: 0, class: "form-control", placeholder: "例: 0.7" %>
    <small class="form-text text-muted">1.0=影響なし、0.7=30%減少、1.2=20%増加</small>
  </div>

  <div class="form-group">
    <%= form.label :is_directional, "方向性", class: "form-label" %>
    <div class="form-check">
      <%= form.radio_button :is_directional, true, class: "form-check-input" %>
      <%= form.label :is_directional_true, "方向性あり（影響元 → 影響先）", class: "form-check-label" %>
    </div>
    <div class="form-check">
      <%= form.radio_button :is_directional, false, class: "form-check-input" %>
      <%= form.label :is_directional_false, "双方向（相互に影響）", class: "form-check-label" %>
    </div>
  </div>

  <div class="form-group">
    <%= form.label :description, "説明（任意）", class: "form-label" %>
    <%= form.text_area :description, rows: 3, class: "form-control", placeholder: "このルールの説明を入力してください" %>
  </div>

  <% if admin_user? %>
    <div class="form-group">
      <%= form.label :is_reference, class: "form-label" %>
      <div class="form-check">
        <%= form.check_box :is_reference, class: "form-check-input" %>
        <%= form.label :is_reference, "システム標準ルールとして設定", class: "form-check-label" %>
      </div>
      <small class="form-text text-muted">チェックすると、すべてのユーザーに自動適用される標準ルールになります</small>
    </div>
  <% end %>

  <div class="form-actions">
    <%= form.submit class: "btn btn-success" %>
    <%= link_to "キャンセル", interaction_rules_path, class: "btn btn-ghost" %>
  </div>
<% end %>
