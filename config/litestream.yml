# Litestream configuration for Cloud Storage replication
# Separate databases for primary, queue, cache, and cable for better performance
# All paths are prefixed with 'production/' to ensure complete separation from development
dbs:
  # Main application database
  - path: /tmp/production.sqlite3
    replicas:
      - type: gcs
        bucket: ${GCS_BUCKET}
        path: production/primary.sqlite3
        # Primary DB replicated moderately frequently
        sync-interval: 30s
  
  # Solid Queue database
  - path: /tmp/production_queue.sqlite3
    replicas:
      - type: gcs
        bucket: ${GCS_BUCKET}
        path: production/queue.sqlite3
        # Increase sync interval to reduce checkpoint contention and locking
        sync-interval: 60s
  
  # Solid Cache database (optional backup - cache can be recreated)
  - path: /tmp/production_cache.sqlite3
    replicas:
      - type: gcs
        bucket: ${GCS_BUCKET}
        path: production/cache.sqlite3
        # Cache can be replicated less frequently
        sync-interval: 300s
  
  # Solid Cable database (Action Cable messages)
  - path: /tmp/production_cable.sqlite3
    replicas:
      - type: gcs
        bucket: ${GCS_BUCKET}
        path: production/cable.sqlite3
        # Reduce checkpoint frequency for cable DB to lower locking pressure
        sync-interval: 60s

