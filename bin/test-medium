#!/bin/bash
# ä¸­é€Ÿãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œï¼ˆé…ã„ãƒ†ã‚¹ãƒˆã‚’é™¤å¤–ï¼‰
#
# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ–¹æ³•ã®è©³ç´°:
#   - README.md: åŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ–¹æ³•
#   - docs/TESTING_GUIDELINES.md: ãƒ†ã‚¹ãƒˆä½œæˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã¨å®Ÿè¡Œæ–¹æ³•
#
# å…¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹å ´åˆ:
#   docker compose run --rm test bundle exec rails test

set -e

echo "ğŸƒ ä¸­é€ŸSystemãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œï¼ˆè¶…é…ã„ãƒ†ã‚¹ãƒˆã‚’é™¤å¤–ã€æ¨å®š: 30-50åˆ†ï¼‰"
echo ""

EXCLUDE_TESTS=(
  "test/system/complete_user_journey_test.rb"
  "test/system/action_cable_realtime_update_test.rb"
  "test/system/all_pages_coverage_test.rb"
)

# å…¨ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—
ALL_TESTS=$(find test/system -name "*_test.rb" -type f)

# é™¤å¤–ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
MEDIUM_TESTS=()
for test in $ALL_TESTS; do
  skip=0
  for exclude in "${EXCLUDE_TESTS[@]}"; do
    if [[ "$test" == "$exclude" ]]; then
      skip=1
      break
    fi
  done
  if [[ $skip -eq 0 ]]; then
    MEDIUM_TESTS+=("$test")
  fi
done

echo "ğŸ“ å®Ÿè¡Œãƒ†ã‚¹ãƒˆæ•°: ${#MEDIUM_TESTS[@]}"
echo "â­ï¸  ã‚¹ã‚­ãƒƒãƒ—: complete_user_journey, action_cable_realtime_update, all_pages_coverage"
echo ""

docker compose run --rm test bundle exec rails test:system "${MEDIUM_TESTS[@]}"
