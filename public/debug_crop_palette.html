<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä½œç‰©ãƒ‘ãƒ¬ãƒƒãƒˆ ãƒ‡ãƒãƒƒã‚°</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 40px;
      background: #f5f5f5;
      line-height: 1.6;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      border-bottom: 3px solid #667eea;
      padding-bottom: 10px;
    }
    h2 {
      color: #667eea;
      margin-top: 30px;
    }
    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      margin: 5px;
      transition: transform 0.2s;
    }
    button:hover {
      transform: translateY(-2px);
    }
    .success {
      background: #10b981;
      color: white;
      padding: 15px;
      border-radius: 6px;
      margin: 10px 0;
      display: none;
    }
    .info {
      background: #f0f9ff;
      border: 1px solid #bae6fd;
      padding: 15px;
      border-radius: 6px;
      margin: 10px 0;
    }
    .code {
      background: #1e293b;
      color: #e2e8f0;
      padding: 15px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      overflow-x: auto;
      margin: 10px 0;
    }
    ul {
      margin: 15px 0;
    }
    li {
      margin: 8px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸŒ± ä½œç‰©ãƒ‘ãƒ¬ãƒƒãƒˆ ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</h1>
    
    <div class="info">
      <strong>ç¾åœ¨ã®çŠ¶æ…‹:</strong>
      <div id="current-state" style="margin-top: 10px;"></div>
    </div>

    <h2>ğŸ”§ ä¿®æ­£å†…å®¹</h2>
    <ul>
      <li>âœ… ãƒ“ãƒ¥ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«: <code>collapsed</code> ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤</li>
      <li>âœ… CSS: z-index ã‚’ 1000 ã«ä¸Šæ˜‡ã€min-height ã‚’è¿½åŠ </li>
      <li>âœ… JavaScript: åˆæœŸçŠ¶æ…‹ã‚’ç¢ºå®Ÿã«ã€Œé–‹ã„ã¦ã„ã‚‹ã€ã«è¨­å®š</li>
      <li>âœ… ãƒ‡ãƒãƒƒã‚°ç”¨ console.log ã‚’è¿½åŠ </li>
    </ul>

    <h2>ğŸ¯ ãƒ‡ãƒãƒƒã‚°æ‰‹é †</h2>
    <ol>
      <li><strong>localStorage ã®æ“ä½œ:</strong>
        <div>
          <button onclick="clearLocalStorage()">localStorage ã‚’ã‚¯ãƒªã‚¢ (null)</button>
          <button onclick="forceOpen()">å¼·åˆ¶çš„ã«é–‹ã (false)</button>
          <div id="clear-success" class="success">âœ“ localStorage ã‚’æ›´æ–°ã—ã¾ã—ãŸ</div>
        </div>
      </li>
      
      <li style="margin-top: 15px;"><strong>ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰:</strong>
        <div>
          <button onclick="location.reload()">ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰</button>
        </div>
      </li>

      <li style="margin-top: 15px;"><strong>é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§ç¢ºèª:</strong>
        <div class="code">
F12 ã‚­ãƒ¼ã‚’æŠ¼ã™ â†’ Console ã‚¿ãƒ–
ã€Œâœ… ä½œç‰©ãƒ‘ãƒ¬ãƒƒãƒˆåˆæœŸåŒ–å®Œäº†: é–‹ã„ã¦ã„ã‚‹ã€ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã‹ç¢ºèª
        </div>
      </li>

      <li style="margin-top: 15px;"><strong>Network ã‚¿ãƒ–ã§ç¢ºèª:</strong>
        <div class="code">
crop_palette.css â†’ 200 OK
crop_palette_drag.js â†’ 200 OK
crop_palette_style.js â†’ 200 OK
        </div>
      </li>

      <li style="margin-top: 15px;"><strong>Elements ã‚¿ãƒ–ã§ç¢ºèª:</strong>
        <div class="code">
&lt;div class="crop-palette-panel" id="crop-palette-panel"&gt;
â€» collapsed ã‚¯ãƒ©ã‚¹ãŒãªã„ã“ã¨ã‚’ç¢ºèª
        </div>
      </li>
    </ol>

    <h2>ğŸš€ æ ½åŸ¹è¨ˆç”»çµæœãƒšãƒ¼ã‚¸ã¸</h2>
    <div>
      <button onclick="goToResults()">æ ½åŸ¹è¨ˆç”»çµæœãƒšãƒ¼ã‚¸ã‚’é–‹ã</button>
    </div>

    <h2>ğŸ“ ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºç­–</h2>
    <ul>
      <li><strong>ãƒ‘ãƒãƒ«ãŒè¦‹ãˆãªã„:</strong> localStorage ã‚’ã‚¯ãƒªã‚¢ã—ã¦ãƒªãƒ­ãƒ¼ãƒ‰</li>
      <li><strong>CSS ãŒé©ç”¨ã•ã‚Œãªã„:</strong> ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒªãƒ­ãƒ¼ãƒ‰ (Ctrl+Shift+R ã¾ãŸã¯ Cmd+Shift+R)</li>
      <li><strong>JavaScript ã‚¨ãƒ©ãƒ¼:</strong> Console ã‚¿ãƒ–ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª</li>
      <li><strong>z-index ã®å•é¡Œ:</strong> Elements ã‚¿ãƒ–ã§ä»–ã®è¦ç´ ã® z-index ã‚’ç¢ºèª</li>
    </ul>

    <div class="info" style="margin-top: 30px;">
      <strong>ğŸ’¡ ãƒ’ãƒ³ãƒˆ:</strong> ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒåŸå› ã®å ´åˆã€ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒªãƒ­ãƒ¼ãƒ‰ (Ctrl+Shift+R) ã‚’è©¦ã—ã¦ãã ã•ã„ã€‚
    </div>
  </div>

  <script>
    // ç¾åœ¨ã®çŠ¶æ…‹ã‚’è¡¨ç¤º
    function updateState() {
      const state = localStorage.getItem('cropPaletteCollapsed');
      const stateDiv = document.getElementById('current-state');
      stateDiv.innerHTML = `
        <strong>cropPaletteCollapsed:</strong> ${state || 'null (åˆå›ã‚¢ã‚¯ã‚»ã‚¹)'}
        ${state === 'true' ? ' âŒ <em>é–‰ã˜ãŸçŠ¶æ…‹ã§ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™</em>' : ''}
        ${state === 'false' ? ' âœ… <em>é–‹ã„ãŸçŠ¶æ…‹ã§ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™</em>' : ''}
        ${!state ? ' â„¹ï¸ <em>ã¾ã ä¿å­˜ã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼ˆåˆå›ã¯é–‹ã„ãŸçŠ¶æ…‹ï¼‰</em>' : ''}
      `;
    }

    // localStorage ã‚’ã‚¯ãƒªã‚¢
    function clearLocalStorage() {
      const before = localStorage.getItem('cropPaletteCollapsed');
      localStorage.removeItem('cropPaletteCollapsed');
      const after = localStorage.getItem('cropPaletteCollapsed');
      
      console.log('ğŸ—‘ï¸ localStorage ã‚¯ãƒªã‚¢:', { before, after });
      
      document.getElementById('clear-success').style.display = 'block';
      setTimeout(() => {
        document.getElementById('clear-success').style.display = 'none';
      }, 3000);
      updateState();
    }
    
    // å¼·åˆ¶çš„ã«é–‹ã„ãŸçŠ¶æ…‹ã«è¨­å®š
    function forceOpen() {
      localStorage.setItem('cropPaletteCollapsed', 'false');
      console.log('âœ… å¼·åˆ¶çš„ã«é–‹ã„ãŸçŠ¶æ…‹ã«è¨­å®š');
      updateState();
      alert('é–‹ã„ãŸçŠ¶æ…‹ã«è¨­å®šã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚');
    }

    // æ ½åŸ¹è¨ˆç”»çµæœãƒšãƒ¼ã‚¸ã‚’é–‹ã
    function goToResults() {
      // æœ€åˆã®æ ½åŸ¹è¨ˆç”»ã®IDã‚’å–å¾—ã—ã¦é·ç§»
      fetch('/api/v1/public_plans/cultivation_plans')
        .then(res => res.json())
        .then(data => {
          if (data && data.length > 0) {
            window.location.href = `/public_plans/${data[0].id}/results`;
          } else {
            alert('æ ½åŸ¹è¨ˆç”»ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«æ ½åŸ¹è¨ˆç”»ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚');
          }
        })
        .catch(err => {
          console.error(err);
          // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: æ–°ã—ã„ã‚¿ãƒ–ã§æ ½åŸ¹è¨ˆç”»ä¸€è¦§ã‚’é–‹ã
          window.open('/public_plans', '_blank');
        });
    }

    // åˆæœŸåŒ–
    updateState();
  </script>
</body>
</html>

