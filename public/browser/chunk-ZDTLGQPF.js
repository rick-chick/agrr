import{a as T}from"./chunk-BIPRG6LP.js";import{a as F}from"./chunk-AJHKKA3N.js";import{c as j,d as D}from"./chunk-U557IDSH.js";import{d as w,e as B}from"./chunk-FUJATOUC.js";import"./chunk-TEDWIW3V.js";import"./chunk-ZHQLFSMJ.js";import{h as z,j as E}from"./chunk-NXFG3DMW.js";import{$ as C,$a as M,Aa as i,Eb as k,Gb as l,Hb as s,Ia as g,Ma as x,Ra as u,Xa as P,Ya as y,_ as h,_a as S,ab as d,bb as t,cb as e,db as v,hb as O,lb as b,nb as m,vb as r,wb as c,xb as f,yb as I}from"./chunk-OVGF36KA.js";var A=()=>["/public-plans/new"],L=(o,n)=>n.id;function N(o,n){if(o&1&&(t(0,"div",27)(1,"div",28)(2,"div",29)(3,"div",30),r(4,"\u{1F30D}"),e(),t(5,"div",31)(6,"div",32),r(7),l(8,"translate"),e(),t(9,"div",33),r(10),e()()(),t(11,"div",29)(12,"div",30),r(13,"\u{1F3E1}"),e(),t(14,"div",31)(15,"div",32),r(16),l(17,"translate"),e(),t(18,"div",33),r(19),e()()()()()),o&2){let a=m();i(7),c(s(8,5,"public_plans.select_crop.summary.region")),i(3),c(a.farm.name),i(6),c(s(17,7,"public_plans.select_crop.summary.farm_size")),i(3),I("",a.farmSize.name," (",a.farmSize.area_sqm,"\u33A1)")}}function V(o,n){o&1&&(t(0,"p"),r(1),l(2,"translate"),e()),o&2&&(i(),c(s(2,1,"common.loading")))}function q(o,n){if(o&1&&(t(0,"p",16),r(1),e()),o&2){let a=m();i(),c(a.error)}}function Y(o,n){if(o&1&&(t(0,"div",43),r(1),e()),o&2){let a=m().$implicit;i(),c(a.variety)}}function G(o,n){if(o&1){let a=O();t(0,"div",35)(1,"input",37),b("change",function(){let _=h(a).$implicit,$=m(2);return C($.toggleCrop(_))}),e(),t(2,"label",38)(3,"div",39),r(4,"\u{1F96C}"),e(),t(5,"div",40),r(6),e(),u(7,Y,2,1,"div",41),t(8,"div",42),r(9,"\u2713"),e()()()}if(o&2){let a=n.$implicit,p=m(2);i(),d("id","crop_"+a.id)("checked",p.selectedCropIds.has(a.id)),i(),d("for","crop_"+a.id),i(4),c(a.name),i(),d("ngIf",a.variety)}}function H(o,n){if(o&1&&(t(0,"div",34),S(1,G,10,5,"div",35,L),e(),v(3,"div",36)),o&2){let a=m();i(),M(a.crops)}}function J(o,n){o&1&&(t(0,"div",44),r(1),l(2,"translate"),e()),o&2&&(i(),f(" ",s(2,1,"public_plans.select_crop.bottom_bar.hint")," "))}var R=class o{constructor(n,a,p){this.router=n;this.publicPlanService=a;this.publicPlanStore=p}loading=!0;saving=!1;error=null;crops=[];selectedCropIds=new Set;selectedCrops=[];get farm(){return this.publicPlanStore.state.farm}get farmSize(){return this.publicPlanStore.state.farmSize}ngOnInit(){if(!this.farm||!this.farmSize){this.router.navigate(["/public-plans/new"]);return}this.selectedCrops=this.publicPlanStore.state.selectedCrops,this.selectedCropIds=new Set(this.selectedCrops.map(n=>n.id)),this.publicPlanService.getCrops(this.farm.id).subscribe({next:n=>{this.crops=n,this.loading=!1},error:n=>{this.error=n.message,this.loading=!1}})}toggleCrop(n){this.selectedCropIds.has(n.id)?(this.selectedCropIds.delete(n.id),this.selectedCrops=this.selectedCrops.filter(a=>a.id!==n.id)):(this.selectedCropIds.add(n.id),this.selectedCrops.push(n)),this.publicPlanStore.setSelectedCrops(this.selectedCrops)}createPlan(){this.saving||this.selectedCropIds.size===0||!this.farm||!this.farmSize||(this.saving=!0,this.error=null,this.publicPlanService.createPlan(this.farm.id,this.farmSize.id,Array.from(this.selectedCropIds)).subscribe({next:n=>{this.publicPlanStore.setPlanId(n.plan_id),this.router.navigate(["/public-plans/optimizing"],{queryParams:{planId:n.plan_id}})},error:n=>{this.error=n.error?.errors?.join(", ")??n.message??"Failed to create plan.",this.saving=!1}}))}static \u0275fac=function(a){return new(a||o)(g(w),g(T),g(F))};static \u0275cmp=x({type:o,selectors:[["app-public-plan-select-crop"]],decls:60,vars:37,consts:[[1,"public-plans-wrapper"],[1,"free-plans-container"],[1,"compact-header-card"],[1,"compact-header-title"],[1,"title-icon"],[1,"title-text"],[1,"compact-progress"],[1,"compact-step","completed"],[1,"step-number"],[1,"step-label"],[1,"compact-step-divider","completed"],[1,"compact-step","active"],["class","enhanced-summary-card",4,"ngIf"],[1,"content-card"],[1,"content-card-title"],[1,"content-card-subtitle"],[1,"error-message"],[1,"fixed-bottom-bar"],[1,"fixed-bottom-bar-content"],[1,"fixed-bottom-bar-left"],[1,"btn","btn-white","back-button",3,"routerLink"],[1,"selection-counter-group"],[1,"counter-label"],[1,"counter-badge"],[1,"counter-unit"],["type","button",1,"btn-gradient","submit-button","btn",3,"click","disabled"],["class","hint-message",4,"ngIf"],[1,"enhanced-summary-card"],[1,"enhanced-summary-items"],[1,"enhanced-summary-row"],[1,"enhanced-summary-icon"],[1,"enhanced-summary-content"],[1,"enhanced-summary-label"],[1,"enhanced-summary-value"],[1,"enhanced-grid"],[1,"crop-item"],[1,"bottom-spacer"],["type","checkbox",1,"crop-check",3,"change","id","checked"],[1,"crop-card",3,"for"],[1,"crop-emoji"],[1,"crop-name"],["class","crop-variety",4,"ngIf"],[1,"check-mark"],[1,"crop-variety"],[1,"hint-message"]],template:function(a,p){a&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),r(5,"\u{1F331}"),e(),t(6,"span",5),r(7),l(8,"translate"),e()(),t(9,"div",6)(10,"div",7)(11,"div",8),r(12,"\u2713"),e(),t(13,"span",9),r(14),l(15,"translate"),e()(),v(16,"div",10),t(17,"div",7)(18,"div",8),r(19,"\u2713"),e(),t(20,"span",9),r(21),l(22,"translate"),e()(),v(23,"div",10),t(24,"div",11)(25,"div",8),r(26,"3"),e(),t(27,"span",9),r(28),l(29,"translate"),e()()()(),u(30,N,20,9,"div",12),t(31,"div",13)(32,"h2",14),r(33),l(34,"translate"),e(),t(35,"p",15),r(36),l(37,"translate"),e(),P(38,V,3,3,"p")(39,q,2,1,"p",16)(40,H,4,0),e()(),t(41,"div",17)(42,"div",18)(43,"div",19)(44,"a",20),r(45),l(46,"translate"),e(),t(47,"div",21)(48,"span",22),r(49),l(50,"translate"),e(),t(51,"div",23),r(52),e(),t(53,"span",24),r(54),l(55,"translate"),e()()(),t(56,"button",25),b("click",function(){return p.createPlan()}),r(57),l(58,"translate"),e()(),u(59,J,3,3,"div",26),e()()),a&2&&(i(7),c(s(8,16,"public_plans.title")),i(7),c(s(15,18,"public_plans.steps.region")),i(7),c(s(22,20,"public_plans.steps.size")),i(7),c(s(29,22,"public_plans.steps.crop")),i(2),d("ngIf",p.farm&&p.farmSize),i(3),c(s(34,24,"public_plans.select_crop.title")),i(3),c(s(37,26,"public_plans.select_crop.subtitle")),i(2),y(p.loading?38:p.error?39:40),i(6),d("routerLink",k(36,A)),i(),f(" ",s(46,28,"public_plans.select_crop.bottom_bar.back_button")," "),i(4),c(s(50,30,"public_plans.select_crop.bottom_bar.selected_label")),i(3),c(p.selectedCropIds.size),i(2),c(s(55,32,"public_plans.select_crop.bottom_bar.selected_unit")),i(2),d("disabled",p.saving||p.selectedCropIds.size===0),i(),f(" ",s(58,34,"public_plans.select_crop.bottom_bar.submit_button")," "),i(2),d("ngIf",p.selectedCropIds.size===0))},dependencies:[E,z,B,D,j],styles:[".page[_ngcontent-%COMP%]{padding-bottom:100px}.selection-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:var(--font-size-base);color:var(--color-gray-600);margin-bottom:var(--space-4);text-transform:uppercase;letter-spacing:.05em}.region-tabs[_ngcontent-%COMP%]{display:flex;gap:var(--space-3);margin-bottom:var(--space-6);flex-wrap:wrap}.region-tab[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-2);padding:var(--space-3) var(--space-4);background:#fff;border:2px solid var(--color-gray-200);border-radius:var(--radius-md);cursor:pointer;transition:all var(--transition-fast);font-weight:500}.region-tab[_ngcontent-%COMP%]:hover{border-color:var(--color-primary);background:var(--color-gray-50)}.region-tab.active[_ngcontent-%COMP%]{border-color:var(--color-primary);background:var(--color-primary-light);color:#fff}.enhanced-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:var(--space-4)}.enhanced-selection-card[_ngcontent-%COMP%]{background:#fff;border:2px solid var(--color-gray-200);border-radius:var(--radius-lg);padding:var(--space-5);text-align:center;cursor:pointer;transition:all var(--transition-fast)}.enhanced-selection-card[_ngcontent-%COMP%]:hover{border-color:var(--color-info);transform:translateY(-2px)}.enhanced-selection-card.active[_ngcontent-%COMP%]{border-color:var(--color-info);background:var(--color-info-surface);box-shadow:0 0 0 3px #4299e133}.enhanced-card-icon[_ngcontent-%COMP%]{font-size:2.5rem;margin-bottom:var(--space-3)}.enhanced-card-title[_ngcontent-%COMP%]{font-weight:700;font-size:var(--font-size-lg);margin-bottom:var(--space-1)}.enhanced-card-subtitle[_ngcontent-%COMP%]{color:var(--color-gray-600);font-size:var(--font-size-sm)}.enhanced-card-highlight[_ngcontent-%COMP%]{font-size:var(--font-size-2xl);font-weight:900;color:var(--color-info-dark);margin:var(--space-2) 0}.enhanced-card-detail[_ngcontent-%COMP%]{font-size:var(--font-size-sm);color:var(--color-gray-500)}.selection-summary[_ngcontent-%COMP%]{font-weight:700;color:var(--color-gray-700)}.mt-6[_ngcontent-%COMP%]{margin-top:var(--space-6)}.compact-step-divider[_ngcontent-%COMP%]{width:40px;height:2px;background:var(--color-gray-200)}.error-message[_ngcontent-%COMP%]{color:var(--color-error);background:var(--color-error-bg);padding:var(--space-3);border-radius:var(--radius-md);margin-bottom:var(--space-4)}.enhanced-summary-items[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:var(--space-4)}.enhanced-summary-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-3)}.enhanced-summary-icon[_ngcontent-%COMP%]{font-size:1.5rem;background:var(--color-info-light);width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:var(--radius-md)}.enhanced-summary-label[_ngcontent-%COMP%]{font-size:var(--font-size-sm);color:var(--color-gray-600)}.enhanced-summary-value[_ngcontent-%COMP%]{font-weight:700}.crop-check[_ngcontent-%COMP%]{display:none}.crop-card[_ngcontent-%COMP%]{border:2px solid var(--color-gray-200);border-radius:var(--radius-lg);padding:var(--space-5);text-align:center;cursor:pointer;transition:all var(--transition-fast);position:relative;display:block}.crop-card[_ngcontent-%COMP%]:hover{border-color:var(--color-info);transform:translateY(-2px)}.crop-check[_ngcontent-%COMP%]:checked + .crop-card[_ngcontent-%COMP%]{border-color:var(--color-info);background:var(--color-info-surface)}.crop-emoji[_ngcontent-%COMP%]{font-size:2.5rem;margin-bottom:var(--space-2)}.crop-name[_ngcontent-%COMP%]{font-weight:700}.crop-variety[_ngcontent-%COMP%]{font-size:var(--font-size-sm);color:var(--color-gray-600)}.check-mark[_ngcontent-%COMP%]{position:absolute;top:var(--space-2);right:var(--space-2);width:24px;height:24px;background:var(--color-gray-200);color:#fff;border-radius:var(--radius-full);display:flex;align-items:center;justify-content:center;opacity:0;transition:all var(--transition-fast)}.crop-check[_ngcontent-%COMP%]:checked + .crop-card[_ngcontent-%COMP%]   .check-mark[_ngcontent-%COMP%]{opacity:1;background:var(--color-info)}.bottom-spacer[_ngcontent-%COMP%]{height:100px}.fixed-bottom-bar-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-4)}.selection-counter-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-2)}.counter-badge[_ngcontent-%COMP%]{background:var(--color-info);color:#fff;width:28px;height:28px;border-radius:var(--radius-full);display:flex;align-items:center;justify-content:center;font-weight:700}.hint-message[_ngcontent-%COMP%]{text-align:center;color:var(--color-error);font-size:var(--font-size-sm);margin-top:var(--space-2)}.status-badge[_ngcontent-%COMP%]{padding:var(--space-1) var(--space-2);border-radius:var(--radius-full);font-size:.75rem;font-weight:700;text-transform:uppercase}.status-badge.completed[_ngcontent-%COMP%]{background:var(--color-success);color:#fff}.status-badge.optimizing[_ngcontent-%COMP%]{background:var(--gradient-primary);color:#fff}.compact-header-card.success[_ngcontent-%COMP%]{border-left:4px solid var(--color-success)}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:var(--space-4);margin-top:var(--space-6);justify-content:center}.cultivation-results-container[_ngcontent-%COMP%]{padding-bottom:60px}.optimizing-card[_ngcontent-%COMP%]{text-align:center;padding:var(--space-8) var(--space-5)}.progress-spinner[_ngcontent-%COMP%]{margin-bottom:var(--space-6);display:flex;justify-content:center}.spinner[_ngcontent-%COMP%]{width:48px;height:48px;border:4px solid var(--color-gray-200);border-top:4px solid var(--color-info);border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.phase-message[_ngcontent-%COMP%]{font-size:var(--font-size-xl);font-weight:700;margin-bottom:var(--space-2)}.duration-hint[_ngcontent-%COMP%]{color:var(--color-gray-600);font-size:var(--font-size-sm);margin-bottom:var(--space-6)}.progress-bar-container[_ngcontent-%COMP%]{width:100%;height:12px;background:var(--color-gray-200);border-radius:var(--radius-full);overflow:hidden;margin-bottom:var(--space-2)}.progress-bar[_ngcontent-%COMP%]{height:100%;background:var(--gradient-primary);transition:width .3s ease-out}.progress-stats[_ngcontent-%COMP%]{display:flex;justify-content:space-between;color:var(--color-gray-600);font-size:var(--font-size-sm);font-weight:500}.error-container[_ngcontent-%COMP%]{margin-top:var(--space-8)}.error-actions[_ngcontent-%COMP%]{display:flex;gap:var(--space-4);justify-content:center;margin-top:var(--space-4)}"]})};export{R as PublicPlanSelectCropComponent};
