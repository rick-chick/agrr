import{a as F}from"./chunk-5HBRH3B5.js";import"./chunk-U557IDSH.js";import{b as N,e as G}from"./chunk-FUJATOUC.js";import{a as U}from"./chunk-TEDWIW3V.js";import"./chunk-ZHQLFSMJ.js";import{j as T}from"./chunk-NXFG3DMW.js";import{Aa as a,Db as R,Eb as L,Fb as S,Ia as P,K as O,Ma as _,P as s,S as M,T as c,U as m,Xa as x,Ya as C,a as y,ab as d,b as D,bb as o,cb as r,da as f,db as E,g as j,i as I,nb as b,v as k,vb as i,wb as h,xb as A}from"./chunk-OVGF36KA.js";function q(t){t||(t=m(f));let n=new j(e=>{if(t.destroyed){e.next();return}return t.onDestroy(e.next.bind(e))});return e=>e.pipe(O(n))}var v=class t{constructor(n){this.apiClient=n}fetchPlan(n){return this.apiClient.get(`/api/v1/plans/${n}`)}fetchPlanData(n){return this.apiClient.get(`/api/v1/plans/cultivation_plans/${n}/data`)}static \u0275fac=function(e){return new(e||t)(c(U))};static \u0275prov=s({token:t,factory:t.\u0275fac})};var g=new M("PLAN_GATEWAY");var u=class t{constructor(n){this.planGateway=n}execute(n){return k({plan:this.planGateway.fetchPlan(n),planData:this.planGateway.fetchPlanData(n)})}static \u0275fac=function(e){return new(e||t)(c(g))};static \u0275prov=s({token:t,factory:t.\u0275fac})};var $={loading:!0,error:null,plan:null,planData:null},p=class t{constructor(n){this.loadPlanDetailUseCase=n}stateSubject=new I($);state$=this.stateSubject.asObservable();loadPlan(n){this.stateSubject.next(D(y({},$),{loading:!0})),this.loadPlanDetailUseCase.execute(n).subscribe({next:({plan:e,planData:l})=>{this.stateSubject.next({loading:!1,error:null,plan:e,planData:l})},error:e=>{this.stateSubject.next({loading:!1,error:e.message,plan:null,planData:null})}})}static \u0275fac=function(e){return new(e||t)(c(u))};static \u0275prov=s({token:t,factory:t.\u0275fac})};var z=()=>["/plans"],B=t=>["/plans",t,"optimizing"],J=t=>["/plans",t,"task_schedule"];function H(t,n){t&1&&(o(0,"p"),i(1,"Loading..."),r())}function K(t,n){if(t&1&&(o(0,"p",2),i(1),r()),t&2){let e=b();a(),h(e.error)}}function Q(t,n){if(t&1&&E(0,"app-gantt-chart",3),t&2){let e=b(2);d("data",e.planData)}}function X(t,n){if(t&1&&(o(0,"h2"),i(1),r(),o(2,"p"),i(3),r(),x(4,Q,1,1,"app-gantt-chart",3),o(5,"div",4)(6,"a",1),i(7,"Optimizing"),r(),o(8,"a",1),i(9,"Task Schedule"),r()()),t&2){let e=b();a(),h(e.plan.name),a(2),A("Status: ",e.plan.status??"-"),a(),C(e.planData?4:-1),a(2),d("routerLink",S(5,B,e.plan.id)),a(2),d("routerLink",S(7,J,e.plan.id))}}var V=class t{constructor(n,e){this.route=n;this.presenter=e}plan=null;planData=null;loading=!0;error=null;destroyRef=m(f);ngOnInit(){let n=Number(this.route.snapshot.paramMap.get("id"));if(!n){this.error="Invalid plan id.",this.loading=!1;return}this.presenter.state$.pipe(q(this.destroyRef)).subscribe(e=>{this.plan=e.plan,this.planData=e.planData,this.loading=e.loading,this.error=e.error}),this.presenter.loadPlan(n)}static \u0275fac=function(e){return new(e||t)(P(N),P(p))};static \u0275cmp=_({type:t,selectors:[["app-plan-detail"]],features:[R([p,u,{provide:g,useClass:v}])],decls:6,vars:3,consts:[[1,"page"],[3,"routerLink"],[1,"error"],[3,"data"],[1,"actions"]],template:function(e,l){e&1&&(o(0,"section",0)(1,"a",1),i(2,"Back to plans"),r(),x(3,H,2,0,"p")(4,K,2,1,"p",2)(5,X,10,9),r()),e&2&&(a(),d("routerLink",L(2,z)),a(2),C(l.loading?3:l.error?4:l.plan?5:-1))},dependencies:[T,G,F],styles:[".page[_ngcontent-%COMP%]{background:#fff;padding:20px;border-radius:12px;border:1px solid #e3e5e8}.error[_ngcontent-%COMP%]{color:#dc2626}.actions[_ngcontent-%COMP%]{display:flex;gap:12px;margin-top:12px}.actions[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{background:#2563eb;color:#fff;padding:8px 12px;border-radius:6px;text-decoration:none}"]})};export{V as PlanDetailComponent};
