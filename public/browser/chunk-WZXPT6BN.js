import{a as D}from"./chunk-BIPRG6LP.js";import{a as R}from"./chunk-AJHKKA3N.js";import{i as B}from"./chunk-T4Z6357I.js";import{c as T,d as j}from"./chunk-U557IDSH.js";import{d as E}from"./chunk-FUJATOUC.js";import"./chunk-TEDWIW3V.js";import"./chunk-ZHQLFSMJ.js";import{h as w,j as k}from"./chunk-NXFG3DMW.js";import{$ as v,$a as C,Aa as a,Gb as d,Hb as p,Ia as b,Ma as z,Ra as x,Xa as F,Ya as I,_ as u,_a as h,ab as P,bb as n,cb as i,db as y,hb as f,lb as _,nb as s,tb as S,vb as o,wb as c,xb as O,yb as M}from"./chunk-OVGF36KA.js";var N=(r,e)=>e.value,$=(r,e)=>e.id;function Y(r,e){if(r&1){let t=f();n(0,"button",21),_("click",function(){let m=u(t).$implicit,g=s();return v(g.selectRegion(m.value))}),n(1,"span",22),o(2),i(),n(3,"span",23),o(4),i()()}if(r&2){let t=e.$implicit,l=s();S("active",l.selectedRegion===t.value),a(2),c(t.flag),a(2),c(t.label)}}function q(r,e){r&1&&(n(0,"div",18)(1,"p"),o(2),d(3,"translate"),i()()),r&2&&(a(2),c(p(3,1,"common.loading")))}function A(r,e){if(r&1&&(n(0,"p",19),o(1),i()),r&2){let t=s();a(),c(t.error)}}function J(r,e){if(r&1){let t=f();n(0,"div",28),_("click",function(){let m=u(t).$implicit,g=s(2);return v(g.selectFarm(m))}),n(1,"div",29),o(2,"\u{1F69C}"),i(),n(3,"div",30),o(4),i(),n(5,"div",31),o(6),i()()}if(r&2){let t=e.$implicit,l=s(2);S("active",l.selectedFarmId===t.id),a(4),c(t.name),a(2),c(t.region)}}function L(r,e){if(r&1){let t=f();n(0,"div",28),_("click",function(){let m=u(t).$implicit,g=s(3);return v(g.selectFarmSize(m))}),n(1,"div",29),o(2,"\u{1F4D0}"),i(),n(3,"div",30),o(4),i(),n(5,"div",32),o(6),i(),n(7,"div",33),o(8),i()()}if(r&2){let t=e.$implicit,l=s(3);S("active",l.selectedFarmSizeId===t.id),a(4),c(t.name),a(2),O("",t.area_sqm,"\u33A1"),a(2),c(t.description)}}function U(r,e){if(r&1&&(n(0,"section",24)(1,"h3"),o(2),d(3,"translate"),i(),n(4,"div",25),h(5,L,9,5,"div",26,$),i()()),r&2){let t=s(2);a(2),c(p(3,1,"public_plans.select_farm_size.title")),a(3),C(t.farmSizes)}}function G(r,e){if(r&1&&(n(0,"section",24)(1,"h3"),o(2),d(3,"translate"),d(4,"translate"),i(),n(5,"div",25),h(6,J,7,4,"div",26,$),i()(),x(8,U,7,3,"section",27)),r&2){let t=s();a(2),M("",p(3,3,"public_plans.select_farm_size.summary.region")," (",p(4,5,"public_plans.steps.region"),")"),a(4),C(t.farms),a(2),P("ngIf",t.selectedFarmId)}}function H(r,e){if(r&1&&(n(0,"span",39),o(1),i()),r&2){let t=s(2);a(),M(" ",t.selectedFarm.name," / ",t.selectedFarmSize.name," ")}}function K(r,e){if(r&1){let t=f();n(0,"div",34)(1,"div",35)(2,"div",36),x(3,H,2,2,"span",37),i(),n(4,"button",38),_("click",function(){u(t);let m=s();return v(m.goToCropSelection())}),o(5),d(6,"translate"),i()()()}if(r&2){let t=s();a(3),P("ngIf",t.selectedFarm&&t.selectedFarmSize),a(2),O(" ",p(6,2,"public_plans.new.title")," \u2192 ")}}var V=class r{constructor(e,t,l){this.publicPlanService=e;this.publicPlanStore=t;this.router=l}loading=!0;error=null;farms=[];farmSizes=[];selectedRegion="jp";selectedFarmId=null;selectedFarmSizeId=null;selectedFarm=null;selectedFarmSize=null;regions=[{value:"jp",label:"Japan",flag:"\u{1F1EF}\u{1F1F5}"},{value:"us",label:"United States",flag:"\u{1F1FA}\u{1F1F8}"},{value:"in",label:"India",flag:"\u{1F1EE}\u{1F1F3}"}];ngOnInit(){let e=this.publicPlanStore.state;e.farm?(this.selectedFarmId=e.farm.id,this.selectedFarm=e.farm,this.selectedRegion=e.farm.region||"jp"):this.selectedRegion=this.regionFromPath(),e.farmSize&&(this.selectedFarmSizeId=e.farmSize.id,this.selectedFarmSize=e.farmSize),this.loadInitialData()}selectRegion(e){this.selectedRegion=e,this.selectedFarmId=null,this.selectedFarm=null,this.reloadFarms()}selectFarm(e){this.selectedFarmId=e.id,this.selectedFarm=e,this.publicPlanStore.setFarm(e)}selectFarmSize(e){this.selectedFarmSizeId=e.id,this.selectedFarmSize=e,this.publicPlanStore.setFarmSize(e)}reloadFarms(){this.loading=!0,this.error=null,this.publicPlanService.getFarms(this.selectedRegion).subscribe({next:e=>{this.farms=e,this.loading=!1},error:e=>{this.error=e.message,this.loading=!1}})}goToCropSelection(){this.canProceed()&&this.router.navigate(["/public-plans/select-crop"])}canProceed(){return!!(this.selectedFarmId&&this.selectedFarmSizeId)}loadInitialData(){this.loading=!0,this.error=null,this.publicPlanService.getFarmSizes().subscribe({next:e=>{this.farmSizes=e,this.publicPlanService.getFarms(this.selectedRegion).subscribe({next:t=>{this.farms=t,this.loading=!1},error:t=>{this.error=t.message,this.loading=!1}})},error:e=>{this.error=e.message,this.loading=!1}})}regionFromPath(){switch(window.location.pathname.split("/").filter(Boolean)[0]){case"ja":return"jp";case"us":return"us";case"in":return"in";default:return"jp"}}static \u0275fac=function(t){return new(t||r)(b(D),b(R),b(E))};static \u0275cmp=z({type:r,selectors:[["app-public-plan-create"]],decls:48,vars:23,consts:[[1,"public-plans-wrapper"],[1,"free-plans-container"],[1,"compact-header-card"],[1,"compact-header-title"],[1,"title-icon"],[1,"title-text"],[1,"compact-progress"],[1,"compact-step","active"],[1,"step-number"],[1,"step-label"],[1,"compact-step-divider"],[1,"compact-step"],[1,"content-card"],[1,"content-card-title"],[1,"content-card-subtitle"],[1,"selection-section"],[1,"region-tabs"],["type","button",1,"region-tab",3,"active"],[1,"loading-state"],[1,"error-message"],["class","fixed-bottom-bar",4,"ngIf"],["type","button",1,"region-tab",3,"click"],[1,"region-flag"],[1,"region-name"],[1,"selection-section","mt-6"],[1,"enhanced-grid"],[1,"enhanced-selection-card",3,"active"],["class","selection-section mt-6",4,"ngIf"],[1,"enhanced-selection-card",3,"click"],[1,"enhanced-card-icon"],[1,"enhanced-card-title"],[1,"enhanced-card-subtitle"],[1,"enhanced-card-highlight"],[1,"enhanced-card-detail"],[1,"fixed-bottom-bar"],[1,"fixed-bottom-bar-content"],[1,"fixed-bottom-bar-left"],["class","selection-summary",4,"ngIf"],["type","button",1,"btn-gradient","btn",3,"click"],[1,"selection-summary"]],template:function(t,l){t&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),o(5,"\u{1F331}"),i(),n(6,"span",5),o(7),d(8,"translate"),i()(),n(9,"div",6)(10,"div",7)(11,"div",8),o(12,"1"),i(),n(13,"span",9),o(14),d(15,"translate"),i()(),y(16,"div",10),n(17,"div",11)(18,"div",8),o(19,"2"),i(),n(20,"span",9),o(21),d(22,"translate"),i()(),y(23,"div",10),n(24,"div",11)(25,"div",8),o(26,"3"),i(),n(27,"span",9),o(28),d(29,"translate"),i()()()(),n(30,"div",12)(31,"h2",13),o(32),d(33,"translate"),i(),n(34,"p",14),o(35),d(36,"translate"),i(),n(37,"section",15)(38,"h3"),o(39),d(40,"translate"),i(),n(41,"div",16),h(42,Y,5,4,"button",17,N),i()(),F(44,q,4,3,"div",18)(45,A,2,1,"p",19)(46,G,9,7),i()(),x(47,K,7,4,"div",20),i()),t&2&&(a(7),c(p(8,9,"public_plans.title")),a(7),c(p(15,11,"public_plans.steps.region")),a(7),c(p(22,13,"public_plans.steps.size")),a(7),c(p(29,15,"public_plans.steps.crop")),a(4),c(p(33,17,"public_plans.new.title")),a(3),c(p(36,19,"public_plans.new.subtitle")),a(4),c(p(40,21,"public_plans.region_selection.title")),a(3),C(l.regions),a(2),I(l.loading?44:l.error?45:46),a(3),P("ngIf",l.canProceed()))},dependencies:[k,w,B,j,T],styles:[".page[_ngcontent-%COMP%]{padding-bottom:100px}.selection-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:var(--font-size-base);color:var(--color-gray-600);margin-bottom:var(--space-4);text-transform:uppercase;letter-spacing:.05em}.region-tabs[_ngcontent-%COMP%]{display:flex;gap:var(--space-3);margin-bottom:var(--space-6);flex-wrap:wrap}.region-tab[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-2);padding:var(--space-3) var(--space-4);background:#fff;border:2px solid var(--color-gray-200);border-radius:var(--radius-md);cursor:pointer;transition:all var(--transition-fast);font-weight:500}.region-tab[_ngcontent-%COMP%]:hover{border-color:var(--color-primary);background:var(--color-gray-50)}.region-tab.active[_ngcontent-%COMP%]{border-color:var(--color-primary);background:var(--color-primary-light);color:#fff}.enhanced-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:var(--space-4)}.enhanced-selection-card[_ngcontent-%COMP%]{background:#fff;border:2px solid var(--color-gray-200);border-radius:var(--radius-lg);padding:var(--space-5);text-align:center;cursor:pointer;transition:all var(--transition-fast)}.enhanced-selection-card[_ngcontent-%COMP%]:hover{border-color:var(--color-info);transform:translateY(-2px)}.enhanced-selection-card.active[_ngcontent-%COMP%]{border-color:var(--color-info);background:var(--color-info-surface);box-shadow:0 0 0 3px #4299e133}.enhanced-card-icon[_ngcontent-%COMP%]{font-size:2.5rem;margin-bottom:var(--space-3)}.enhanced-card-title[_ngcontent-%COMP%]{font-weight:700;font-size:var(--font-size-lg);margin-bottom:var(--space-1)}.enhanced-card-subtitle[_ngcontent-%COMP%]{color:var(--color-gray-600);font-size:var(--font-size-sm)}.enhanced-card-highlight[_ngcontent-%COMP%]{font-size:var(--font-size-2xl);font-weight:900;color:var(--color-info-dark);margin:var(--space-2) 0}.enhanced-card-detail[_ngcontent-%COMP%]{font-size:var(--font-size-sm);color:var(--color-gray-500)}.selection-summary[_ngcontent-%COMP%]{font-weight:700;color:var(--color-gray-700)}.mt-6[_ngcontent-%COMP%]{margin-top:var(--space-6)}.compact-step-divider[_ngcontent-%COMP%]{width:40px;height:2px;background:var(--color-gray-200)}.error-message[_ngcontent-%COMP%]{color:var(--color-error);background:var(--color-error-bg);padding:var(--space-3);border-radius:var(--radius-md);margin-bottom:var(--space-4)}.enhanced-summary-items[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:var(--space-4)}.enhanced-summary-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-3)}.enhanced-summary-icon[_ngcontent-%COMP%]{font-size:1.5rem;background:var(--color-info-light);width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:var(--radius-md)}.enhanced-summary-label[_ngcontent-%COMP%]{font-size:var(--font-size-sm);color:var(--color-gray-600)}.enhanced-summary-value[_ngcontent-%COMP%]{font-weight:700}.crop-check[_ngcontent-%COMP%]{display:none}.crop-card[_ngcontent-%COMP%]{border:2px solid var(--color-gray-200);border-radius:var(--radius-lg);padding:var(--space-5);text-align:center;cursor:pointer;transition:all var(--transition-fast);position:relative;display:block}.crop-card[_ngcontent-%COMP%]:hover{border-color:var(--color-info);transform:translateY(-2px)}.crop-check[_ngcontent-%COMP%]:checked + .crop-card[_ngcontent-%COMP%]{border-color:var(--color-info);background:var(--color-info-surface)}.crop-emoji[_ngcontent-%COMP%]{font-size:2.5rem;margin-bottom:var(--space-2)}.crop-name[_ngcontent-%COMP%]{font-weight:700}.crop-variety[_ngcontent-%COMP%]{font-size:var(--font-size-sm);color:var(--color-gray-600)}.check-mark[_ngcontent-%COMP%]{position:absolute;top:var(--space-2);right:var(--space-2);width:24px;height:24px;background:var(--color-gray-200);color:#fff;border-radius:var(--radius-full);display:flex;align-items:center;justify-content:center;opacity:0;transition:all var(--transition-fast)}.crop-check[_ngcontent-%COMP%]:checked + .crop-card[_ngcontent-%COMP%]   .check-mark[_ngcontent-%COMP%]{opacity:1;background:var(--color-info)}.bottom-spacer[_ngcontent-%COMP%]{height:100px}.fixed-bottom-bar-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-4)}.selection-counter-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-2)}.counter-badge[_ngcontent-%COMP%]{background:var(--color-info);color:#fff;width:28px;height:28px;border-radius:var(--radius-full);display:flex;align-items:center;justify-content:center;font-weight:700}.hint-message[_ngcontent-%COMP%]{text-align:center;color:var(--color-error);font-size:var(--font-size-sm);margin-top:var(--space-2)}.status-badge[_ngcontent-%COMP%]{padding:var(--space-1) var(--space-2);border-radius:var(--radius-full);font-size:.75rem;font-weight:700;text-transform:uppercase}.status-badge.completed[_ngcontent-%COMP%]{background:var(--color-success);color:#fff}.status-badge.optimizing[_ngcontent-%COMP%]{background:var(--gradient-primary);color:#fff}.compact-header-card.success[_ngcontent-%COMP%]{border-left:4px solid var(--color-success)}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:var(--space-4);margin-top:var(--space-6);justify-content:center}.cultivation-results-container[_ngcontent-%COMP%]{padding-bottom:60px}.optimizing-card[_ngcontent-%COMP%]{text-align:center;padding:var(--space-8) var(--space-5)}.progress-spinner[_ngcontent-%COMP%]{margin-bottom:var(--space-6);display:flex;justify-content:center}.spinner[_ngcontent-%COMP%]{width:48px;height:48px;border:4px solid var(--color-gray-200);border-top:4px solid var(--color-info);border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.phase-message[_ngcontent-%COMP%]{font-size:var(--font-size-xl);font-weight:700;margin-bottom:var(--space-2)}.duration-hint[_ngcontent-%COMP%]{color:var(--color-gray-600);font-size:var(--font-size-sm);margin-bottom:var(--space-6)}.progress-bar-container[_ngcontent-%COMP%]{width:100%;height:12px;background:var(--color-gray-200);border-radius:var(--radius-full);overflow:hidden;margin-bottom:var(--space-2)}.progress-bar[_ngcontent-%COMP%]{height:100%;background:var(--gradient-primary);transition:width .3s ease-out}.progress-stats[_ngcontent-%COMP%]{display:flex;justify-content:space-between;color:var(--color-gray-600);font-size:var(--font-size-sm);font-weight:500}.error-container[_ngcontent-%COMP%]{margin-top:var(--space-8)}.error-actions[_ngcontent-%COMP%]{display:flex;gap:var(--space-4);justify-content:center;margin-top:var(--space-4)}"]})};export{V as PublicPlanCreateComponent};
