import{a as v}from"./chunk-TVVNGJEJ.js";import{a as d}from"./chunk-TEDWIW3V.js";import{A as u,J as c,L as l,P as i,T as g,U as s,ja as o,m as n,q as p}from"./chunk-OVGF36KA.js";var t=class r{constructor(e){this.apiClient=e}getCurrentUser(){return this.apiClient.get("/api/v1/auth/me")}logout(){return this.apiClient.delete("/api/v1/auth/logout")}static \u0275fac=function(a){return new(a||r)(g(d))};static \u0275prov=i({token:r,factory:r.\u0275fac,providedIn:"root"})};var f=class r{userSignal=o(null);loadingSignal=o(!1);loaded=!1;api=s(t);apiKeyService=s(v);user(){return this.userSignal()}loading(){return this.loadingSignal()}loadCurrentUser(){return this.loaded?n(this.userSignal()):(this.loadingSignal.set(!0),this.api.getCurrentUser().pipe(p(e=>e.user),l(e=>{e.api_key&&this.apiKeyService.setApiKey(e.api_key),this.userSignal.set(e),this.loaded=!0,this.loadingSignal.set(!1)}),u(()=>(this.userSignal.set(null),this.loaded=!0,this.loadingSignal.set(!1),n(null)))))}ensureApiKey(e){return this.loadCurrentUser().pipe(c(()=>e))}logout(){return this.api.logout().pipe(l(()=>{this.apiKeyService.clearApiKey(),this.userSignal.set(null)}))}static \u0275fac=function(a){return new(a||r)};static \u0275prov=i({token:r,factory:r.\u0275fac,providedIn:"root"})};export{f as a};
