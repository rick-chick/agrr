import{a as S}from"./chunk-AJHKKA3N.js";import{a as I}from"./chunk-M2VVVRR3.js";import{c as k,d as w}from"./chunk-U557IDSH.js";import{b as M,d as x,e as z}from"./chunk-FUJATOUC.js";import"./chunk-ZHQLFSMJ.js";import{j as y}from"./chunk-NXFG3DMW.js";import{Aa as e,Eb as v,Fb as f,Gb as s,Hb as p,Ia as d,Ib as b,Ma as h,Xa as _,Ya as P,ab as m,bb as n,cb as t,db as u,sb as C,vb as i,wb as c,xb as g,yb as O}from"./chunk-OVGF36KA.js";var j=a=>({count:a}),T=a=>({time:a}),B=()=>["/public-plans/select-crop"],D=()=>["/public-plans/new"];function R(a,l){a&1&&(n(0,"div",19)(1,"p",20),i(2),s(3,"translate"),t(),n(4,"div",21)(5,"a",22),i(6),s(7,"translate"),t(),n(8,"a",23),i(9),s(10,"translate"),t()()()),a&2&&(e(2),c(p(3,5,"public_plans.optimizing.error.title")),e(3),m("routerLink",v(11,B)),e(),g(" ",p(7,7,"public_plans.optimizing.error.try_again")," "),e(2),m("routerLink",v(12,D)),e(),g(" ",p(10,9,"public_plans.optimizing.error.start_over")," "))}var E=class a{constructor(l,r,o,F){this.route=l;this.router=r;this.optimizationService=o;this.publicPlanStore=F}status="pending";progress=0;phaseMessage="";planId=0;elapsedTime=0;subscription=null;timer;get farm(){return this.publicPlanStore.state.farm}get selectedCropsCount(){return this.publicPlanStore.state.selectedCrops.length}ngOnInit(){if(this.planId=Number(this.route.snapshot.queryParamMap.get("planId"))||this.publicPlanStore.state.planId||0,!this.planId){this.status="invalid_plan_id",this.router.navigate(["/public-plans/new"]);return}this.startTimer(),this.subscription=this.optimizationService.subscribe("OptimizationChannel",{cultivation_plan_id:this.planId},{received:l=>{let r=l;r.status&&(this.status=r.status,r.status==="completed"&&this.router.navigate(["/public-plans/results"],{queryParams:{planId:this.planId}})),typeof r.progress=="number"&&(this.progress=r.progress),r.phase_message&&(this.phaseMessage=r.phase_message)}})}ngOnDestroy(){this.subscription?.unsubscribe(),this.stopTimer()}startTimer(){this.timer=setInterval(()=>{this.elapsedTime++},1e3)}stopTimer(){this.timer&&clearInterval(this.timer)}static \u0275fac=function(r){return new(r||a)(d(M),d(x),d(I),d(S))};static \u0275cmp=h({type:a,selectors:[["app-public-plan-optimizing"]],decls:33,vars:27,consts:[[1,"public-plans-wrapper"],[1,"free-plans-container"],[1,"compact-header-card"],[1,"compact-header-title"],[1,"title-icon"],[1,"title-text"],[1,"status-badge","optimizing"],[1,"compact-subtitle"],[1,"content-card","optimizing-card"],[1,"progress-spinner"],[1,"spinner"],[1,"progress-info"],[1,"phase-message"],[1,"duration-hint"],[1,"progress-bar-container"],[1,"progress-bar"],[1,"progress-stats"],[1,"progress-percentage"],[1,"elapsed-time"],[1,"error-container"],[1,"error-message"],[1,"error-actions"],[1,"btn","btn-primary",3,"routerLink"],[1,"btn","btn-white",3,"routerLink"]],template:function(r,o){r&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),i(5,"\u{1F331}"),t(),n(6,"span",5),i(7),s(8,"translate"),t(),n(9,"span",6),i(10),s(11,"translate"),t()(),n(12,"div",7),i(13),s(14,"translate"),t()(),n(15,"div",8)(16,"div",9),u(17,"div",10),t(),n(18,"div",11)(19,"h3",12),i(20),t(),n(21,"p",13),i(22),s(23,"translate"),t()(),n(24,"div",14),u(25,"div",15),t(),n(26,"div",16)(27,"span",17),i(28),t(),n(29,"span",18),i(30),s(31,"translate"),t()(),_(32,R,11,13,"div",19),t()()()),r&2&&(e(7),c(p(8,11,"public_plans.title")),e(3),c(p(11,13,"public_plans.optimizing.status_badge")),e(3),O(" ",o.farm==null?null:o.farm.name," \xB7 ",b(14,15,"public_plans.optimizing.crops_count",f(23,j,o.selectedCropsCount))," "),e(7),c(o.phaseMessage),e(2),c(p(23,18,"public_plans.optimizing.progress.duration_hint")),e(3),C("width",o.progress,"%"),e(3),g("",o.progress,"%"),e(2),c(b(31,20,"public_plans.optimizing.progress.elapsed_time",f(25,T,o.elapsedTime))),e(2),P(o.status==="failed"?32:-1))},dependencies:[y,z,w,k],styles:[".page[_ngcontent-%COMP%]{padding-bottom:100px}.selection-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:var(--font-size-base);color:var(--color-gray-600);margin-bottom:var(--space-4);text-transform:uppercase;letter-spacing:.05em}.region-tabs[_ngcontent-%COMP%]{display:flex;gap:var(--space-3);margin-bottom:var(--space-6);flex-wrap:wrap}.region-tab[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-2);padding:var(--space-3) var(--space-4);background:#fff;border:2px solid var(--color-gray-200);border-radius:var(--radius-md);cursor:pointer;transition:all var(--transition-fast);font-weight:500}.region-tab[_ngcontent-%COMP%]:hover{border-color:var(--color-primary);background:var(--color-gray-50)}.region-tab.active[_ngcontent-%COMP%]{border-color:var(--color-primary);background:var(--color-primary-light);color:#fff}.enhanced-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:var(--space-4)}.enhanced-selection-card[_ngcontent-%COMP%]{background:#fff;border:2px solid var(--color-gray-200);border-radius:var(--radius-lg);padding:var(--space-5);text-align:center;cursor:pointer;transition:all var(--transition-fast)}.enhanced-selection-card[_ngcontent-%COMP%]:hover{border-color:var(--color-info);transform:translateY(-2px)}.enhanced-selection-card.active[_ngcontent-%COMP%]{border-color:var(--color-info);background:var(--color-info-surface);box-shadow:0 0 0 3px #4299e133}.enhanced-card-icon[_ngcontent-%COMP%]{font-size:2.5rem;margin-bottom:var(--space-3)}.enhanced-card-title[_ngcontent-%COMP%]{font-weight:700;font-size:var(--font-size-lg);margin-bottom:var(--space-1)}.enhanced-card-subtitle[_ngcontent-%COMP%]{color:var(--color-gray-600);font-size:var(--font-size-sm)}.enhanced-card-highlight[_ngcontent-%COMP%]{font-size:var(--font-size-2xl);font-weight:900;color:var(--color-info-dark);margin:var(--space-2) 0}.enhanced-card-detail[_ngcontent-%COMP%]{font-size:var(--font-size-sm);color:var(--color-gray-500)}.selection-summary[_ngcontent-%COMP%]{font-weight:700;color:var(--color-gray-700)}.mt-6[_ngcontent-%COMP%]{margin-top:var(--space-6)}.compact-step-divider[_ngcontent-%COMP%]{width:40px;height:2px;background:var(--color-gray-200)}.error-message[_ngcontent-%COMP%]{color:var(--color-error);background:var(--color-error-bg);padding:var(--space-3);border-radius:var(--radius-md);margin-bottom:var(--space-4)}.enhanced-summary-items[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:var(--space-4)}.enhanced-summary-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-3)}.enhanced-summary-icon[_ngcontent-%COMP%]{font-size:1.5rem;background:var(--color-info-light);width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:var(--radius-md)}.enhanced-summary-label[_ngcontent-%COMP%]{font-size:var(--font-size-sm);color:var(--color-gray-600)}.enhanced-summary-value[_ngcontent-%COMP%]{font-weight:700}.crop-check[_ngcontent-%COMP%]{display:none}.crop-card[_ngcontent-%COMP%]{border:2px solid var(--color-gray-200);border-radius:var(--radius-lg);padding:var(--space-5);text-align:center;cursor:pointer;transition:all var(--transition-fast);position:relative;display:block}.crop-card[_ngcontent-%COMP%]:hover{border-color:var(--color-info);transform:translateY(-2px)}.crop-check[_ngcontent-%COMP%]:checked + .crop-card[_ngcontent-%COMP%]{border-color:var(--color-info);background:var(--color-info-surface)}.crop-emoji[_ngcontent-%COMP%]{font-size:2.5rem;margin-bottom:var(--space-2)}.crop-name[_ngcontent-%COMP%]{font-weight:700}.crop-variety[_ngcontent-%COMP%]{font-size:var(--font-size-sm);color:var(--color-gray-600)}.check-mark[_ngcontent-%COMP%]{position:absolute;top:var(--space-2);right:var(--space-2);width:24px;height:24px;background:var(--color-gray-200);color:#fff;border-radius:var(--radius-full);display:flex;align-items:center;justify-content:center;opacity:0;transition:all var(--transition-fast)}.crop-check[_ngcontent-%COMP%]:checked + .crop-card[_ngcontent-%COMP%]   .check-mark[_ngcontent-%COMP%]{opacity:1;background:var(--color-info)}.bottom-spacer[_ngcontent-%COMP%]{height:100px}.fixed-bottom-bar-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-4)}.selection-counter-group[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--space-2)}.counter-badge[_ngcontent-%COMP%]{background:var(--color-info);color:#fff;width:28px;height:28px;border-radius:var(--radius-full);display:flex;align-items:center;justify-content:center;font-weight:700}.hint-message[_ngcontent-%COMP%]{text-align:center;color:var(--color-error);font-size:var(--font-size-sm);margin-top:var(--space-2)}.status-badge[_ngcontent-%COMP%]{padding:var(--space-1) var(--space-2);border-radius:var(--radius-full);font-size:.75rem;font-weight:700;text-transform:uppercase}.status-badge.completed[_ngcontent-%COMP%]{background:var(--color-success);color:#fff}.status-badge.optimizing[_ngcontent-%COMP%]{background:var(--gradient-primary);color:#fff}.compact-header-card.success[_ngcontent-%COMP%]{border-left:4px solid var(--color-success)}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:var(--space-4);margin-top:var(--space-6);justify-content:center}.cultivation-results-container[_ngcontent-%COMP%]{padding-bottom:60px}.optimizing-card[_ngcontent-%COMP%]{text-align:center;padding:var(--space-8) var(--space-5)}.progress-spinner[_ngcontent-%COMP%]{margin-bottom:var(--space-6);display:flex;justify-content:center}.spinner[_ngcontent-%COMP%]{width:48px;height:48px;border:4px solid var(--color-gray-200);border-top:4px solid var(--color-info);border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.phase-message[_ngcontent-%COMP%]{font-size:var(--font-size-xl);font-weight:700;margin-bottom:var(--space-2)}.duration-hint[_ngcontent-%COMP%]{color:var(--color-gray-600);font-size:var(--font-size-sm);margin-bottom:var(--space-6)}.progress-bar-container[_ngcontent-%COMP%]{width:100%;height:12px;background:var(--color-gray-200);border-radius:var(--radius-full);overflow:hidden;margin-bottom:var(--space-2)}.progress-bar[_ngcontent-%COMP%]{height:100%;background:var(--gradient-primary);transition:width .3s ease-out}.progress-stats[_ngcontent-%COMP%]{display:flex;justify-content:space-between;color:var(--color-gray-600);font-size:var(--font-size-sm);font-weight:500}.error-container[_ngcontent-%COMP%]{margin-top:var(--space-8)}.error-actions[_ngcontent-%COMP%]{display:flex;gap:var(--space-4);justify-content:center;margin-top:var(--space-4)}"]})};export{E as PublicPlanOptimizingComponent};
